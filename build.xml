<!--
 *
 * Biocep: R-based Platform for Computational e-Science.
 *  
 * Copyright (C) 2007-2009 Karim Chine - karim.chine@m4x.org
 *  
 * Copyright (C) 2007 EMBL-EBI-Microarray Informatics 
 *  
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 * @author Karim Chine karim.chine@m4x.org
 *
-->


<project name="BioCep" default="compile" basedir=".">

	
	<taskdef name="if"  classpath="lib/beangenlibs/ant-contrib-1.0b3.jar" classname="net.sf.antcontrib.logic.IfTask"/>
	<taskdef name="for" classpath="lib/beangenlibs/ant-contrib-1.0b3.jar" classname="net.sf.antcontrib.logic.ForTask"/>

	<target name="initializeProperties">

		<property environment="env"/>
		
		<if><not><isset property="env.R_LIBS"/></not>
			<then><property name="JRI_LIB_PATH" value="${env.R_HOME}/library/rJava/jri"/></then>
			<else><property name="JRI_LIB_PATH" value="${env.R_LIBS}/rJava/jri"/></else>
		</if>

		<if><isset property="env.JDK_HOME"/>
			<then><property name="JDK_HOME" value="${env.JDK_HOME}"/></then>
			<else><property name="JDK_HOME" value="${env.JAVA_HOME}"/></else>
		</if>

		
		
		<property name="CORE_JAR" value="RJB.jar"/>
		<property name="RPF_JAR" value="RPF.jar"/>
		<property name="SRV_JAR" value="RSRV.jar"/>
		<property name="JRI_JAR" value="lib/desktop/JRI.jar"/>
		<property name="LOGGING_JAR" value="lib/log/commons-logging-1.1.1.jar"/>
		<property name="LOG4J_JAR" value="lib/log/log4j-1.2.15.jar"/>	
		<property name="HTMLPARSER_JAR" value="lib/j2ee/htmlparser.jar"/>					
		<property name="SSH_JAR" value="lib/pool/ganymed-ssh2.jar"/>
		<property name="SSH_TUNNEL_JAR" value="lib/pool/jsch-0.1.40.jar"/>		
		<property name="FTP_JAR" value="lib/pool/edtftpj.jar"/>		
		<property name="ORACLE_JAR" value="lib/jdbc/ojdbc-14.jar"/>
		<property name="MYSQL_JAR" value="lib/jdbc/mysql-connector-java-5.1.0-bin.jar"/>		
		<property name="DERBY_DB_JAR" value="lib/desktop/derby.jar"/>		
		<property name="DERBY_NET_JAR" value="lib/desktop/derbynet.jar"/>		
		<property name="DERBY_JAR" value="lib/jdbc/derbyclient.jar"/>
		<property name="GROOVY_JAR" value="lib/desktop/groovy-all-1.5.4.jar"/>
		
		<property name="JAVASCI_JAR" value="lib/scilab/javasci.jar"/>
		
		<property name="JETTY_JAR" value="lib/desktop/jetty-6.1.11.jar"/>
		<property name="JETTY_UTIL_JAR" value="lib/desktop/jetty-util-6.1.11.jar"/>
		<property name="JETTY_CLIENT_JAR" value="lib/desktop/jetty-client-6.1.11.jar"/>
		<property name="JETTY_SERVLET_API_JAR" value="lib/desktop/servlet-api-2.5-6.1.11.jar"/>
		
		
		<if><os family="windows"/>
			<then>
				<property name="R_LIB_PATH" value="${env.R_HOME}/bin"/>
				<property name="windows.root.slash" value="/"/>
				<if><isset property="env.PATH"/>
					<then><property name="SYSTEM_PATH" value="${env.PATH}"/></then>
					<else><property name="SYSTEM_PATH" value="${env.Path}"/></else>
				</if>						
			</then>
			<else>
				<property name="R_LIB_PATH" value="${env.R_HOME}/lib"/>
				<property name="windows.root.slash" value=""/>
				<property name="SYSTEM_PATH" value="${env.PATH}"/>
			</else>
		</if>
		
	</target>
	
	<target name="gen" depends="initializeProperties,compile">
		
		<if><not><isset property="file"/></not>	<then><property name="file" value=""/>	</then></if>
		<if><not><isset property="dir"/></not><then><property name="dir" value=""/></then></if>
		<if><not><isset property="outputdir"/></not><then><property name="outputdir" value=""/></then></if>
		<if><not><isset property="mappingjar"/></not><then><property name="mappingjar" value=""/></then></if>
		<if><not><isset property="warname"/></not><then><property name="warname" value=""/></then></if>
		<if><not><isset property="propsembed"/></not><then><property name="propsembed" value=""/></then></if>
		<if><not><isset property="keepintermediate"/></not><then><property name="keepintermediate" value=""/></then></if>
		<if><not><isset property="formatsource"/></not><then><property name="formatsource" value=""/></then></if>
		<if><not><isset property="ws.r.api"/></not><then><property name="ws.r.api" value="true"/></then></if>
		<if><not><isset property="targetjdk"/></not><then><property name="targetjdk" value=""/></then></if>
		
		<java maxmemory="1024m" classname="Gen" fork="true">
			
			<classpath>
				
				<pathelement path="${CORE_JAR}"/>
				
				<pathelement path="lib/beangenlibs/ant-contrib-1.0b3.jar"/>
				<pathelement path="lib/beangenlibs/geronimo-jms_1.1_spec-1.0.jar"/>
				<pathelement path="lib/beangenlibs/jakarta-oro-2.0.8.jar"/>
				<pathelement path="lib/beangenlibs/jakarta-regexp-1.4.jar"/>
				<pathelement path="lib/beangenlibs/jalopy-ant.jar"/>
				<pathelement path="lib/beangenlibs/jalopy.jar"/>
				<pathelement path="lib/beangenlibs/jaxws-libs.jar"/>
				<pathelement path="lib/beangenlibs/jdom.jar"/>		
				
				<pathelement path="lib/jaxws/jaxws-tools.jar"/>
				
				<!--
				<pathelement path="lib/jaxws/FastInfoset.jar"/>
				<pathelement path="lib/jaxws/http.jar"/>
				<pathelement path="lib/jaxws/jaxb-api.jar"/>
				<pathelement path="lib/jaxws/jaxb-impl.jar"/>
				<pathelement path="lib/jaxws/jaxb-xjc.jar"/>
				<pathelement path="lib/jaxws/jaxws-api.jar"/>
				<pathelement path="lib/jaxws/jaxws-rt.jar"/>				
				<pathelement path="lib/jaxws/jsr173_api.jar"/>
				<pathelement path="lib/jaxws/jsr181-api.jar"/>
				<pathelement path="lib/jaxws/jsr250-api.jar"/>
				<pathelement path="lib/jaxws/saaj-api.jar"/>
				<pathelement path="lib/jaxws/saaj-impl.jar"/>
				<pathelement path="lib/jaxws/sjsxp.jar"/>
				
				-->
				
				<pathelement path="${JDK_HOME}/lib/tools.jar"/>
				<pathelement path="lib/ant/ant.jar"/>
				<pathelement path="lib/ant/ant-launcher.jar"/>
								
				
				<pathelement path="${JRI_JAR}"/>
				<pathelement path="${LOGGING_JAR}"/>
				<pathelement path="${LOG4J_JAR}"/>
				<pathelement path="${HTMLPARSER_JAR}"/>
				<pathelement path="${SSH_JAR}"/>
				<pathelement path="${SSH_TUNNEL_JAR}"/>
				<pathelement path="${FTP_JAR}"/>		
				
				
				<pathelement path="lib/desktop/jsp-api-2.1.jar"/>
				<pathelement path="lib/desktop/jsp-2.1.jar"/>
								
				<pathelement path="${JETTY_JAR}"/>
				<pathelement path="${JETTY_UTIL_JAR}"/>
				<pathelement path="${JETTY_CLIENT_JAR}"/>
				<pathelement path="${JETTY_SERVLET_API_JAR}"/>
				
				<pathelement path="lib/desktop/activation.jar"/>
				<pathelement path="lib/desktop/mail.jar"/>					
				<pathelement path="lib/desktop/jython.jar"/>
				<pathelement path="lib/j2ee/commons-codec-1.3.jar"/>
				<pathelement path="lib/j2ee/commons-httpclient-3.1-rc1.jar"/>	
				
				<pathelement path="lib/svg/batik-svggen.jar"/>
				<pathelement path="lib/svg/batik-dom.jar"/>
				<pathelement path="lib/svg/batik-awt-util.jar"/>
				<pathelement path="lib/svg/batik-util.jar"/>
				
				<pathelement path="lib/pool/commons-pool-1.3.jar"/>

			</classpath>
			
			<env key="PATH" path="${R_LIB_PATH}"/>
			<env key="LD_LIBRARY_PATH" path="${R_LIB_PATH}"/>
			<env key="JAVA_HOME" path="${JDK_HOME}"/>
			
			<jvmarg value="-Dfile=${file}"/>
			<jvmarg value="-Ddir=${dir}"/>
			<jvmarg value="-Doutputdir=${outputdir}"/>
			<jvmarg value="-Dmappingjar=${mappingjar}"/>
			<jvmarg value="-Dwarname=${warname}"/>
			<jvmarg value="-Dpropsembed=${propsembed}"/>
			<jvmarg value="-Dkeepintermediate=${keepintermediate}"/>
			<jvmarg value="-Dformatsource=${formatsource}"/>
			<jvmarg value="-Djava.library.path=${JRI_LIB_PATH}"/>
			<jvmarg value="-Djri.jar=${JRI_JAR}"/>
			<jvmarg value="-Dws.r.api=${ws.r.api}"/>
			<jvmarg value="-Dtargetjdk=${targetjdk}"/>
			
			<jvmarg	value="-Dorg.apache.commons.logging.Log=org.apache.commons.logging.impl.Log4JLogger"/>
			<jvmarg value="-Dlog4j.rootCategory=INFO,A1"/>
			<jvmarg	value="-Dlog4j.appender.A1=org.apache.log4j.ConsoleAppender"/>
			<jvmarg	value="-Dlog4j.appender.A1.layout=org.apache.log4j.PatternLayout"/>
			<jvmarg	value="-Dlog4j.appender.A1.layout.ConversionPattern= [%-5p] - %m%n"/>
			
		</java>
		
		<if>
			<or>
				<equals arg1="${keepintermediate}" arg2="false"/>
				<equals arg1="${keepintermediate}" arg2="FALSE"/>
			</or>
			<then>
				<delete>
					<fileset dir="${outputdir}">
						<include name="**/_temp*.jar"/>
					</fileset>
				</delete>
				<delete dir="${outputdir}/src"/>
				<delete dir="${outputdir}/test/"/>
			</then>
		</if>
		
	</target>
	
	
	
	
	<target name="dgen" depends="initializeProperties,compile">
		
		<if><not><isset property="file"/></not>	<then><property name="file" value=""/>	</then></if>
		<if><not><isset property="dir"/></not><then><property name="dir" value=""/></then></if>
		<if><not><isset property="outputdir"/></not><then><property name="outputdir" value=""/></then></if>
		<if><not><isset property="mappingjar"/></not><then><property name="mappingjar" value=""/></then></if>
		<if><not><isset property="warname"/></not><then><property name="warname" value=""/></then></if>
		<if><not><isset property="propsembed"/></not><then><property name="propsembed" value=""/></then></if>
		<if><not><isset property="keepintermediate"/></not><then><property name="keepintermediate" value=""/></then></if>
		<if><not><isset property="formatsource"/></not><then><property name="formatsource" value=""/></then></if>
		<if><not><isset property="ws.r.api"/></not><then><property name="ws.r.api" value=""/></then></if>
		<if><not><isset property="targetjdk"/></not><then><property name="targetjdk" value=""/></then></if>
		
		<java maxmemory="1024m" classname="ToolsMain" fork="true">
			
			<classpath>
				<pathelement path="${CORE_JAR}"/>
				
				<pathelement path="lib/beangenlibs/ant-contrib-1.0b3.jar"/>
				<pathelement path="lib/beangenlibs/geronimo-jms_1.1_spec-1.0.jar"/>
				<pathelement path="lib/beangenlibs/jakarta-oro-2.0.8.jar"/>
				<pathelement path="lib/beangenlibs/jakarta-regexp-1.4.jar"/>
				<pathelement path="lib/beangenlibs/jalopy-ant.jar"/>
				<pathelement path="lib/beangenlibs/jalopy.jar"/>
				<pathelement path="lib/beangenlibs/jaxws-libs.jar"/>
				<pathelement path="lib/beangenlibs/jdom.jar"/>			
				
				<pathelement path="lib/jaxws/jaxws-tools.jar"/>
				
			<!--
				<pathelement path="lib/jaxws/FastInfoset.jar"/>
				<pathelement path="lib/jaxws/http.jar"/>
				<pathelement path="lib/jaxws/jaxb-api.jar"/>
				<pathelement path="lib/jaxws/jaxb-impl.jar"/>
				<pathelement path="lib/jaxws/jaxb-xjc.jar"/>
				<pathelement path="lib/jaxws/jaxws-api.jar"/>
				<pathelement path="lib/jaxws/jaxws-rt.jar"/>				
				<pathelement path="lib/jaxws/jsr173_api.jar"/>
				<pathelement path="lib/jaxws/jsr181-api.jar"/>
				<pathelement path="lib/jaxws/jsr250-api.jar"/>
				<pathelement path="lib/jaxws/saaj-api.jar"/>
				<pathelement path="lib/jaxws/saaj-impl.jar"/>
				<pathelement path="lib/jaxws/sjsxp.jar"/>
				-->

				
				
				
				<pathelement path="${JDK_HOME}/lib/tools.jar"/>
				<pathelement path="lib/ant/ant.jar"/>
				<pathelement path="lib/ant/ant-launcher.jar"/>
				
				
				<pathelement path="${JRI_JAR}"/>
				<pathelement path="${LOGGING_JAR}"/>
				<pathelement path="${LOG4J_JAR}"/>
				<pathelement path="${HTMLPARSER_JAR}"/>
				<pathelement path="${SSH_JAR}"/>
				<pathelement path="${SSH_TUNNEL_JAR}"/>
				<pathelement path="${FTP_JAR}"/>		
				
				<pathelement path="lib/desktop/jsp-api-2.1.jar"/>
				<pathelement path="lib/desktop/jsp-2.1.jar"/>
				
				
				<pathelement path="${JETTY_JAR}"/>
				<pathelement path="${JETTY_UTIL_JAR}"/>
				<pathelement path="${JETTY_CLIENT_JAR}"/>
				<pathelement path="${JETTY_SERVLET_API_JAR}"/>
				
				
				<pathelement path="lib/desktop/activation.jar"/>
				<pathelement path="lib/desktop/mail.jar"/>					
				<pathelement path="lib/desktop/jython.jar"/>
				<pathelement path="lib/j2ee/commons-codec-1.3.jar"/>
				<pathelement path="lib/j2ee/commons-httpclient-3.1-rc1.jar"/>	
				
				<pathelement path="lib/svg/batik-svggen.jar"/>
				<pathelement path="lib/svg/batik-dom.jar"/>
				<pathelement path="lib/svg/batik-awt-util.jar"/>
				<pathelement path="lib/svg/batik-util.jar"/>
				
				<pathelement path="lib/pool/commons-pool-1.3.jar"/>


			</classpath>
			
			<jvmarg value="-Dfile=${file}"/>
			<jvmarg value="-Ddir=${dir}"/>
			<jvmarg value="-Doutputdir=${outputdir}"/>
			<jvmarg value="-Dmappingjar=${mappingjar}"/>
			<jvmarg value="-Dwarname=${warname}"/>
			<jvmarg value="-Dpropsembed=${propsembed}"/>
			<jvmarg value="-Dkeepintermediate=${keepintermediate}"/>
			<jvmarg value="-Dformatsource=${formatsource}"/>
			<jvmarg value="-Djri.jar=${JRI_JAR}"/>
			<jvmarg value="-Dws.r.api=${ws.r.api}"/>
			<jvmarg value="-Dtargetjdk=${targetjdk}"/>
			
		</java>
		
		<if>
			<or>
				<equals arg1="${keepintermediate}" arg2="false"/>
				<equals arg1="${keepintermediate}" arg2="FALSE"/>
			</or>
			<then>
				<delete>
					<fileset dir="${outputdir}">
						<include name="**/_temp*.jar"/>
					</fileset>
				</delete>
				<delete dir="${outputdir}/src"/>
				<delete dir="${outputdir}/test/"/>
			</then>
		</if>
		
	</target>

	
	<target name="server" depends="initializeProperties">
		
		<if><not><isset property="spawn"/></not><then><property name="spawn" value="false"/></then></if>
		<if><not><isset property="prefix"/></not><then><property name="prefix" value=""/></then></if>		
		<if><not><isset property="name"/></not><then><property name="name" value=""/></then></if>
		<if><not><isset property="autoname"/></not><then><property name="autoname" value=""/></then></if>
		<if><not><isset property="node"/></not><then><property name="node" value=""/></then></if>				
		
		<if><not><isset property="working.dir.root"/></not><then><property name="working.dir.root" value=""/></then></if>		
		<if><not><isset property="properties.extension"/></not><then><property name="properties.extension" value=""/></then></if>
		<if><not><isset property="listener.stub"/></not><then><property name="listener.stub" value=""/></then></if>
		<if><not><isset property="private"/></not><then><property name="private" value=""/></then></if>
		
		<if><not><isset property="log.file"/></not><then><property name="log.file" value="biocep.log"/></then></if>
		
		<if><not><isset property="naming.mode"/></not><then><property name="naming.mode" value=""/></then></if>
		<if><not><isset property="db.type"/></not><then><property name="db.type" value=""/></then></if>
		<if><not><isset property="db.host"/></not><then><property name="db.host" value=""/></then></if>
		<if><not><isset property="db.port"/></not><then><property name="db.port" value=""/></then></if>
		<if><not><isset property="db.dir"/></not><then><property name="db.dir" value=""/></then></if>
		<if><not><isset property="db.name"/></not><then><property name="db.name" value=""/></then></if>		
		<if><not><isset property="db.user"/></not><then><property name="db.user" value=""/></then></if>
		<if><not><isset property="db.password"/></not><then><property name="db.password" value=""/></then></if>
		
		<if><not><isset property="registry.host"/></not><then><property name="registry.host" value=""/></then></if>
		<if><not><isset property="registry.port"/></not><then><property name="registry.port" value=""/></then></if>
		
		<if><not><isset property="httpregistry.url"/></not><then><property name="httpregistry.url" value=""/></then></if>
		<if><not><isset property="httpregistry.login"/></not><then><property name="httpregistry.login" value=""/></then></if>
		<if><not><isset property="httpregistry.password"/></not><then><property name="httpregistry.password" value=""/></then></if>
		
		<if><not><isset property="servant.classpath"/></not><then><property name="servant.classpath" value=""/></then></if>
		<if><not><isset property="preprocess.help"/></not><then><property name="preprocess.help" value=""/></then></if>
		<if><not><isset property="apply.sandbox"/></not><then><property name="apply.sandbox" value=""/></then></if>
		<if><not><isset property="attr.lsf.processid"/></not><then><property name="attr.lsf.processid" value=""/></then></if>
		<if><not><isset property="node.manager.name"/></not><then><property name="node.manager.name" value="NODE_MANAGER"/></then></if>
		<if><not><isset property="http.port"/></not><then><property name="http.port" value=""/></then></if>
		<if><not><isset property="rmi.port.start"/></not><then><property name="rmi.port.start" value=""/></then></if>
		<if><not><isset property="use.default.libs"/></not><then><property name="use.default.libs" value=""/></then></if>
		
		<if><not><isset property="cloud"/></not><then><property name="cloud" value=""/></then></if>
		
		<java maxmemory="256m" classname="org.kchine.rpf.MainServer"
			fork="true" spawn="${spawn}" newenvironement="true">
			
			<classpath>
				
				
				<pathelement path="${RPF_JAR}"/>
				
				<pathelement path="${ORACLE_JAR}"/>
				<pathelement path="${MYSQL_JAR}"/>
				<pathelement path="${DERBY_JAR}"/>
								
				<pathelement path="${JRI_JAR}"/>
				<pathelement path="${LOGGING_JAR}"/>
				<pathelement path="${LOG4J_JAR}"/>
				<pathelement path="${HTMLPARSER_JAR}"/>
				<pathelement path="${SSH_JAR}"/>
				<pathelement path="${SSH_TUNNEL_JAR}"/>
				<pathelement path="${FTP_JAR}"/>		
				
				<pathelement path="lib/desktop/jsp-api-2.1.jar"/>
				<pathelement path="lib/desktop/jsp-2.1.jar"/>
				
				
				<pathelement path="${JETTY_JAR}"/>
				<pathelement path="${JETTY_UTIL_JAR}"/>
				<pathelement path="${JETTY_CLIENT_JAR}"/>
				<pathelement path="${JETTY_SERVLET_API_JAR}"/>				
				
				
				<pathelement path="lib/desktop/activation.jar"/>
				<pathelement path="lib/desktop/mail.jar"/>					
				<pathelement path="lib/desktop/jython.jar"/>
				<pathelement path="lib/j2ee/commons-codec-1.3.jar"/>
				<pathelement path="lib/j2ee/commons-httpclient-3.1-rc1.jar"/>	

				<pathelement path="${GROOVY_JAR}"/>
				<pathelement path="${JAVASCI_JAR}"/>
				
				
				<pathelement path="lib/svg/batik-svggen.jar"/>
				<pathelement path="lib/svg/batik-dom.jar"/>
				<pathelement path="lib/svg/batik-awt-util.jar"/>
				<pathelement path="lib/svg/batik-util.jar"/>
				<pathelement path="lib/svg/batik-ext.jar"/>
				<pathelement path="lib/svg/batik-xml.jar"/>
				
				<pathelement path="lib/pool/commons-pool-1.3.jar"/>
				
				
				<pathelement path="${servant.classpath}"/>
				
			</classpath>
			
			<env key="PATH" path="${SYSTEM_PATH}${path.separator}${R_LIB_PATH}"/>
			<env key="LD_LIBRARY_PATH" path="${R_LIB_PATH}"/>
			<jvmarg
			value="-Djava.library.path=${JRI_LIB_PATH}"/>
			<jvmarg value="-Djava.rmi.server.codebase=${servant.codebase}"/>
			<jvmarg value="-Dservantclass=${servantclass}"/>
			<jvmarg value="-Dname=${name}"/>
			<jvmarg value="-Dautoname=${autoname}"/>
			<jvmarg value="-Dprefix=${prefix}"/>
			<jvmarg value="-Dnode=${node}"/>
			<jvmarg value="-Dlistener.stub=${listener.stub}"/>
			<jvmarg value="-Dprivate=${private}"/>
			<jvmarg value="-Dpreprocess.help=${preprocess.help}"/>
			<jvmarg value="-Dapply.sandbox=${apply.sandbox}"/>
			<jvmarg value="-Dattr.lsf.processid=${attr.lsf.processid}"/>
			<jvmarg value="-Dnode.manager.name=${node.manager.name}"/>
			<jvmarg value="-Dhttp.port=${http.port}"/>
			<jvmarg value="-Drmi.port.start=${rmi.port.start}"/>
			<jvmarg value="-Dworking.dir.root=${working.dir.root}"/>

			
			
			
			<!-- REG MODE -->
			<jvmarg value="-Dregistry.host=${registry.host}"/>
			<jvmarg value="-Dregistry.port=${registry.port}"/>
			
			<!-- DB MODE -->
				
			<jvmarg value="-Dnaming.mode=${naming.mode}"/>
			<jvmarg value="-Ddb.type=${db.type}"/>
			<jvmarg value="-Ddb.host=${db.host}"/>
			<jvmarg value="-Ddb.port=${db.port}"/>
			<jvmarg value="-Ddb.dir=${db.dir}"/>
			<jvmarg value="-Ddb.name=${db.name}"/>			
			<jvmarg value="-Ddb.user=${db.user}"/>
			<jvmarg value="-Ddb.password=${db.password}"/>
			
			<jvmarg value="-Dhttpregistry.url=${httpregistry.url}"/>
			<jvmarg value="-Dhttpregistry.login=${httpregistry.login}"/>
			<jvmarg value="-Dhttpregistry.password=${httpregistry.password}"/>
			
			<jvmarg value="-Dproperties.extension=${properties.extension}"/>
			
			<jvmarg value="-Dcloud=${cloud}"/>
			
			<!-- LOG PARAMS -->
			<jvmarg	value="-Dorg.apache.commons.logging.Log=org.apache.commons.logging.impl.Log4JLogger"/>
			<jvmarg value="-Dlog4j.rootCategory=INFO,A1,A2,A3"/>
			
			<jvmarg value="-Dlog4j.appender.A1=org.apache.log4j.ConsoleAppender"/>
			<jvmarg	value="-Dlog4j.appender.A1.layout=org.apache.log4j.PatternLayout"/>
			<jvmarg	value="-Dlog4j.appender.A1.layout.ConversionPattern= [%-5p] - %m%n"/>
			
			<jvmarg	value="-Dlog4j.appender.A2=org.kchine.rpf.RemoteAppender"/>
			<jvmarg	value="-Dlog4j.appender.A2.layout=org.apache.log4j.PatternLayout"/>
			<jvmarg	value="-Dlog4j.appender.A2.layout.ConversionPattern= [%-5p] - %m%n"/>
			
			<jvmarg value="-Dlog4j.appender.A3=org.apache.log4j.FileAppender"/>
			<jvmarg value="-Dlog4j.appender.A3.file=${log.file}"/>
			<jvmarg	value="-Dlog4j.appender.A3.layout=org.apache.log4j.PatternLayout"/>
			<jvmarg	value="-Dlog4j.appender.A3.layout.ConversionPattern= [%-5p] - %m%n"/>			

			
		</java>
		
	</target>

	
	
	
	
	<target name="derby.startup" depends="initializeProperties">
		<if>
			<not>
				<isset property="db.port"/>
			</not>
			<then>
				<property name="db.port" value="1527"/>
			</then>
		</if>
		
		<if>
			<not>
				<isset property="db.dir"/>
			</not>
			<then>
				<property name="db.dir" value=""/>
			</then>
		</if>
		
		<if>
			<not>
				<isset property="spawn"/>
			</not>
			<then>
				<property name="spawn" value="false"/>
			</then>
		</if>
		<java fork="true"
			spawn="${spawn}" classname="org.apache.derby.drda.NetworkServerControl">
			<classpath>
				<pathelement path="${DERBY_NET_JAR}"/>
				<pathelement path="${DERBY_DB_JAR}"/>
				<pathelement path="${DERBY_JAR}"/>
			</classpath>
			<jvmarg value="-Dderby.system.home=${db.dir}"/>
			<arg value="start"/>
			<arg value="-h"/>
			<arg value="0.0.0.0"/>
			<arg value="-p"/>
			<arg value="${db.port}"/>
		</java>
	</target>
	
	
	<target name="demodb" depends="initializeProperties" >		
		<antcall target="db">					
			<param name="naming.mode" value="db"/>
			<param name="db.initscript" value="${basedir}/VirtualRWorkbench/initscript.sql" />		
		</antcall>			
	</target>	
	
	<target name="derby.shutdown"  depends="initializeProperties">
		
		<if>
			<not>
				<isset property="db.port"/>
			</not>
			<then>
				<property name="db.port" value="1527"/>
			</then>
		</if>
		
		<if>
			<not>
				<isset property="spawn"/>
			</not>
			<then>
				<property name="spawn" value="false"/>
			</then>
		</if>
				
		<java fork="true" classname="org.apache.derby.drda.NetworkServerControl">
			
			<classpath>
				<pathelement path="${DERBY_NET_JAR}"/>
				<pathelement path="${DERBY_DB_JAR}"/>
				<pathelement path="${DERBY_JAR}"/>
			</classpath>
			
			<arg value="shutdown"/>
			<arg value="-h"/>
			<arg value="0.0.0.0"/>
			<arg value="-p"/>
			<arg value="${db.port}"/>
			
		</java>
	</target>
	
	<target name="tomcat.startup" depends="initializeProperties">
		<if>
			<not>
				<isset property="spawn"/>
			</not>
			<then>
				<property name="spawn" value="false"/>
			</then>
		</if>
		<java jar="${env.TOMCAT_HOME}/bin/bootstrap.jar" fork="true"
			spawn="${spawn}">
			<jvmarg value="-Dcatalina.home=${env.TOMCAT_HOME}"/>
			<arg value="start"/>
		</java>
	</target>
	
	<target name="tomcat.shutdown" depends="initializeProperties">
		<if>
			<not>
				<isset property="spawn"/>
			</not>
			<then>
				<property name="spawn" value="true"/>
			</then>
		</if>
		<java jar="${env.TOMCAT_HOME}/bin/bootstrap.jar" fork="true"
			spawn="${spawn}">
			<jvmarg value="-Dcatalina.home=${env.TOMCAT_HOME}"/>
			<arg value="stop"/>
		</java>
	</target>
	
	<target name="rmiregistry"  depends="initializeProperties" >
		<if><not><isset property="spawn"/></not><then><property name="spawn" value="false"/></then></if>
		<if><not><isset property="port"/></not><then><property name="port" value="1099"/></then></if>
		<if><not><isset property="kill"/></not><then><property name="kill" value=""/></then></if>
		<if><not><isset property="show"/></not><then><property name="show" value=""/></then></if>
		<if><not><isset property="unbindall"/></not><then><property name="unbindall" value=""/></then></if>
		<if><not><isset property="invoke"/></not><then><property name="invoke" value=""/></then></if>
		
		<java classname="RmiRegistry" fork="true"
			spawn="${spawn}">
			<classpath>
				<pathelement path="${CORE_JAR}"/>
				<pathelement path="${LOGGING_JAR}"/>
			</classpath>
			<jvmarg value="-Dport=${port}"/>
			<jvmarg value="-Dshow=${show}"/>
			<jvmarg value="-Dkill=${kill}"/>
			<jvmarg value="-Dunbindall=${unbindall}"/>
			<jvmarg value="-Dinvoke=${invoke}"/>
		</java>
	</target>
	
	<target name="db"  depends="initializeProperties">
		
		<if><not><isset property="db.type"/></not><then><property name="db.type" value=""/></then></if>
		<if><not><isset property="db.host"/></not><then><property name="db.host" value=""/></then></if>
		<if><not><isset property="db.port"/></not><then><property name="db.port" value=""/></then></if>		
		<if><not><isset property="db.dir"/></not><then><property name="db.dir" value=""/></then></if>		
		<if><not><isset property="db.name"/></not><then><property name="db.name" value=""/></then></if>		
		<if><not><isset property="db.user"/></not><then><property name="db.user" value=""/></then></if>
		<if><not><isset property="db.password"/></not><then><property name="db.password" value=""/></then></if>
		<if><not><isset property="env.BIOCEP_SRC_HOME"/></not><then><property name="biocep.src.home" value="."/></then><else><property name="biocep.src.home" value="${env.BIOCEP_SRC_HOME}"/></else></if>
		<if><not><isset property="db.initscript"/></not><then><property name="db.initscript" value=""/></then></if>		

		<java classname="org.kchine.rpf.db.RegenerateDB" fork="true" newenvironment="">
			
			<classpath>
				<pathelement path="${CORE_JAR}"/>
				<pathelement path="${LOGGING_JAR}"/>
				<pathelement path="${LOG4J_JAR}"/>
				<pathelement path="${ORACLE_JAR}"/>
				<pathelement path="${MYSQL_JAR}"/>
				<pathelement path="${DERBY_JAR}"/>
				<pathelement path="${SSH_JAR}"/>
				<pathelement path="${SSH_TUNNEL_JAR}"/>
				<pathelement path="${FTP_JAR}"/>
			</classpath>
			
			<jvmarg value="-Ddb.type=${db.type}"/>
			<jvmarg value="-Ddb.host=${db.host}"/>
			<jvmarg value="-Ddb.port=${db.port}"/>
			<jvmarg value="-Ddb.dir=${db.dir}"/>
			<jvmarg value="-Ddb.name=${db.name}"/>			
			<jvmarg value="-Ddb.user=${db.user}"/>
			<jvmarg value="-Ddb.password=${db.password}"/>
			
			<jvmarg value="-Ddb.initscript=${db.initscript}"/>
			<jvmarg value="-Dbiocep.src.home=${biocep.src.home}"/>			
			<jvmarg	value="-Dorg.apache.commons.logging.Log=org.apache.commons.logging.impl.Log4JLogger"/>
			<jvmarg value="-Dlog4j.rootCategory=INFO,A1"/>
			<jvmarg	value="-Dlog4j.appender.A1=org.apache.log4j.ConsoleAppender"/>
			<jvmarg	value="-Dlog4j.appender.A1.layout=org.apache.log4j.PatternLayout"/>
			<jvmarg	value="-Dlog4j.appender.A1.layout.ConversionPattern= [%-5p] - %m%n"/>
			
		</java>
	</target>

	<target name="sshtunnel"  depends="initializeProperties">
		
		<if><not><isset property="host"/></not><then><property name="host" value=""/></then></if>
		<if><not><isset property="user"/></not><then><property name="user" value=""/></then></if>
		<if><not><isset property="password"/></not><then><property name="password" value=""/></then></if>
		<if><not><isset property="port"/></not><then><property name="port" value=""/></then></if>		
		<if><not><isset property="tunnel.local.port"/></not><then><property name="tunnel.local.port" value=""/></then></if>
		<if><not><isset property="tunnel.remote.host"/></not><then><property name="tunnel.remote.host" value=""/></then></if>
		<if><not><isset property="tunnel.remote.port"/></not><then><property name="tunnel.remote.port" value="."/></then><else><property name="biocep.src.home" value="${env.BIOCEP_SRC_HOME}"/></else></if>		

		<java classname="SshTunnel" fork="true" newenvironment="">
			
			<classpath>
				<pathelement path="${CORE_JAR}"/>
				<pathelement path="${LOGGING_JAR}"/>
				<pathelement path="${LOG4J_JAR}"/>
				<pathelement path="${SSH_TUNNEL_JAR}"/>
			</classpath>
			
			<jvmarg value="-Dhost=${host}"/>
			<jvmarg value="-Duser=${user}"/>
			<jvmarg value="-Dpassword=${password}"/>
			<jvmarg value="-Dport=${port}"/>			
			<jvmarg value="-Dtunnel.local.port=${tunnel.local.port}"/>
			<jvmarg value="-Dtunnel.remote.host=${tunnel.remote.host}"/>
			<jvmarg value="-Dtunnel.remote.port=${tunnel.remote.port}"/>
			<jvmarg	value="-Dorg.apache.commons.logging.Log=org.apache.commons.logging.impl.Log4JLogger"/>
			<jvmarg value="-Dlog4j.rootCategory=INFO,A1"/>
			<jvmarg	value="-Dlog4j.appender.A1=org.apache.log4j.ConsoleAppender"/>
			<jvmarg	value="-Dlog4j.appender.A1.layout=org.apache.log4j.PatternLayout"/>
			<jvmarg	value="-Dlog4j.appender.A1.layout.ConversionPattern= [%-5p] - %m%n"/>
			
		</java>
	</target>
	
	
	
	<target name="top"  depends="initializeProperties">
		
		<if><not><isset property="spawn"/></not><then><property name="spawn" value="false"/></then></if>
		
		<if><not><isset property="naming.mode"/></not><then><property name="naming.mode" value=""/></then></if>
		
		<if><not><isset property="db.type"/></not><then><property name="db.type" value=""/></then></if>
		<if><not><isset property="db.host"/></not><then><property name="db.host" value=""/></then></if>
		<if><not><isset property="db.port"/></not><then><property name="db.port" value=""/></then></if>
		<if><not><isset property="db.dir"/></not><then><property name="db.dir" value=""/></then></if>
		<if><not><isset property="db.name"/></not><then><property name="db.name" value=""/></then></if>		
		<if><not><isset property="db.user"/></not><then><property name="db.user" value=""/></then></if>
		<if><not><isset property="db.password"/></not><then><property name="db.password" value=""/></then></if>		
		
		<if><not><isset property="httpregistry.url"/></not><then><property name="httpregistry.url" value=""/></then></if>
		<if><not><isset property="httpregistry.login"/></not><then><property name="httpregistry.login" value=""/></then></if>
		<if><not><isset property="httpregistry.password"/></not><then><property name="httpregistry.password" value=""/></then></if>
		
		<java classname="org.kchine.rpf.db.monitor.Supervisor"
			fork="true" spawn="${spawn}">
			
			<classpath>
				<pathelement path="${CORE_JAR}"/>
				<pathelement path="${LOGGING_JAR}"/>
				<pathelement path="${LOG4J_JAR}"/>
				<pathelement path="${ORACLE_JAR}"/>
				<pathelement path="${MYSQL_JAR}"/>
				<pathelement path="${DERBY_JAR}"/>
				<pathelement path="${SSH_JAR}"/>
				<pathelement path="${SSH_TUNNEL_JAR}"/>
				<pathelement path="${FTP_JAR}"/>				
				<pathelement path="lib/pool/commons-pool-1.3.jar"/>								
				<pathelement path="lib/j2ee/commons-codec-1.3.jar"/>
				<pathelement path="lib/j2ee/commons-httpclient-3.1-rc1.jar"/>
			</classpath>
			
			<jvmarg value="-Dnaming.mode=${naming.mode}"/>
			<jvmarg value="-Ddb.type=${db.type}"/>
			<jvmarg value="-Ddb.host=${db.host}"/>
			<jvmarg value="-Ddb.port=${db.port}"/>
			<jvmarg value="-Ddb.dir=${db.dir}"/>
			<jvmarg value="-Ddb.name=${db.name}"/>			
			<jvmarg value="-Ddb.user=${db.user}"/>
			<jvmarg value="-Ddb.password=${db.password}"/>
						
			<jvmarg value="-Dhttpregistry.url=${httpregistry.url}"/>
			<jvmarg value="-Dhttpregistry.login=${httpregistry.login}"/>
			<jvmarg value="-Dhttpregistry.password=${httpregistry.password}"/>
			
			<jvmarg	value="-Dorg.apache.commons.logging.Log=org.apache.commons.logging.impl.Log4JLogger"/>
			<jvmarg value="-Dlog4j.rootCategory=INFO,A1"/>
			<jvmarg	value="-Dlog4j.appender.A1=org.apache.log4j.ConsoleAppender"/>
			<jvmarg	value="-Dlog4j.appender.A1.layout=org.apache.log4j.PatternLayout"/>
			<jvmarg	value="-Dlog4j.appender.A1.layout.ConversionPattern= [%-5p] - %m%n"/>
			
		</java>
	</target>
	
	<target name="node"  depends="initializeProperties">
		
		<if><not><isset property="spawn"/></not><then><property name="spawn" value="false"/></then></if>
		
		
		<if><not><isset property="naming.mode"/></not><then><property name="naming.mode" value=""/></then></if>
		<if><not><isset property="db.type"/></not><then><property name="db.type" value=""/></then></if>
		<if><not><isset property="db.host"/></not><then><property name="db.host" value=""/></then></if>
		<if><not><isset property="db.port"/></not><then><property name="db.port" value=""/></then></if>
		<if><not><isset property="db.dir"/></not><then><property name="db.dir" value=""/></then></if>
		<if><not><isset property="db.name"/></not><then><property name="db.name" value=""/></then></if>		
		<if><not><isset property="db.user"/></not><then><property name="db.user" value=""/></then></if>
		<if><not><isset property="db.password"/></not><then><property name="db.password" value=""/></then></if>
		
		
		<if><not><isset property="node.manager.name"/></not><then><property name="node.manager.name" value="NODE_MANAGER"/></then></if>				
		<if><not><isset property="node.name"/></not><then><property name="node.name" value=""/></then></if>						
		<if><not><isset property="job"/></not><then><property name="job" value="java"/></then></if>
		<if><not><isset property="server"/></not><then><property name="server" value="true"/></then></if>		
		
		<java classname="org.kchine.rpf.db.MainNodeManager"
			fork="true" spawn="${spawn}">
			
			<classpath>
				<pathelement path="${CORE_JAR}"/>
				<pathelement path="${LOGGING_JAR}"/>
				<pathelement path="${LOG4J_JAR}"/>
				<pathelement path="${ORACLE_JAR}"/>
				<pathelement path="${MYSQL_JAR}"/>
				<pathelement path="${DERBY_JAR}"/>
				<pathelement path="${SSH_JAR}"/>
				<pathelement path="${SSH_TUNNEL_JAR}"/>
				<pathelement path="${FTP_JAR}"/>				
				<pathelement path="lib/pool/commons-pool-1.3.jar"/>
								
			</classpath>
			
			<jvmarg value="-Dnaming.mode=db"/>
			<jvmarg value="-Ddb.type=${db.type}"/>
			<jvmarg value="-Ddb.host=${db.host}"/>
			<jvmarg value="-Ddb.port=${db.port}"/>
			<jvmarg value="-Ddb.dir=${db.dir}"/>
			<jvmarg value="-Ddb.name=${db.name}"/>			
			<jvmarg value="-Ddb.user=${db.user}"/>
			<jvmarg value="-Ddb.password=${db.password}"/>
			
			<jvmarg value="-Dnode.manager.name=${node.manager.name}"/>
			<jvmarg value="-Dnode.name=${node.name}"/>
			<jvmarg value="-Djob=${job}"/>
			<jvmarg value="-Dserver=${server}"/>			
			
			<jvmarg	value="-Dorg.apache.commons.logging.Log=org.apache.commons.logging.impl.Log4JLogger"/>
			<jvmarg value="-Dlog4j.rootCategory=INFO,A1"/>
			<jvmarg	value="-Dlog4j.appender.A1=org.apache.log4j.ConsoleAppender"/>
			<jvmarg	value="-Dlog4j.appender.A1.layout=org.apache.log4j.PatternLayout"/>
			<jvmarg	value="-Dlog4j.appender.A1.layout.ConversionPattern= [%-5p] - %m%n"/>
			
		</java>
	</target>
	
	<target name="client"  depends="initializeProperties">
		
		<if>
			<not>
				<isset property="clientjarurls"/>
			</not>
			<then>
				<property name="clientjarurls" value=""/>
			</then>
		</if>
		
		<java maxmemory="1024m" classname="${client.mainclass}" fork="true">
			<classpath>
				
				<pathelement path="${CORE_JAR}"/>
				<pathelement path="${JRI_JAR}"/>
				<pathelement path="${LOGGING_JAR}"/>
				<pathelement path="${LOG4J_JAR}"/>
				<pathelement path="${HTMLPARSER_JAR}"/>
				
				<pathelement path="lib/pool/commons-pool-1.3.jar"/>
				<pathelement path="${ORACLE_JAR}"/>
				<pathelement path="${MYSQL_JAR}"/>
				<pathelement path="${DERBY_JAR}"/>
				<pathelement path="${SSH_JAR}"/>
				<pathelement path="${SSH_TUNNEL_JAR}"/>
				<pathelement path="${FTP_JAR}"/>				
				<pathelement path="lib/j2ee/commons-codec-1.3.jar"/>
				<pathelement path="lib/j2ee/commons-httpclient-3.1-rc1.jar"/>				
				
				<path refid="${client.path.id}"/>
			</classpath>
			
			<jvmarg value="-Djava.rmi.server.codebase=${clientjarurls}"/>			
			<jvmarg	value="-Dpools.provider.factory=org.kchine.rpf.db.ServantsProviderFactoryDB"/>

			
			<jvmarg value="-Dpools.dbmode.type=${client.db.type}"/>
			<jvmarg value="-Dpools.dbmode.host=${client.db.host}"/>
			<jvmarg value="-Dpools.dbmode.port=${client.db.port}"/>
			<jvmarg value="-Dpools.dbmode.dir=${client.db.dir}"/>
			<jvmarg value="-Dpools.dbmode.name=${client.db.name}"/>
			<jvmarg value="-Dpools.dbmode.user=${client.db.user}"/>
			<jvmarg value="-Dpools.dbmode.password=${client.db.password}"/>
			
			<jvmarg	value="-Dpools.dbmode.defaultpoolname=${client.defaultpoolname}"/>			
			
			<jvmarg value="-Durl=${url}"/>
			<jvmarg	value="-Dorg.apache.commons.logging.Log=org.apache.commons.logging.impl.Log4JLogger"/>
			<jvmarg value="-Dlog4j.rootCategory=INFO,A1"/>
			<jvmarg	value="-Dlog4j.appender.A1=org.apache.log4j.ConsoleAppender"/>
			<jvmarg value="-Dlog4j.appender.A1.layout=org.apache.log4j.PatternLayout"/>
			<jvmarg	value="-Dlog4j.appender.A1.layout.ConversionPattern= [%-5p] - %m%n"/>
			
		</java>
		
	</target>
	
	<target name="gui" depends="initializeProperties,compile">
		
			
		<if><not><isset property="spawn"/></not><then><property name="spawn" value="false"/></then></if>
		<if><not><isset property="lf"/></not><then><property name="lf" value="0"/></then></if>
		<if><not><isset property="mode"/></not><then><property name="mode" value=""/></then></if>
		<if><not><isset property="stub"/></not><then><property name="stub" value=""/></then></if>				
		<if><not><isset property="localtomcat.port"/></not><then><property name="localtomcat.port" value=""/></then></if>
		<if><not><isset property="url"/></not><then><property name="url" value=""/></then></if>
		<if><not><isset property="name"/></not><then><property name="name" value=""/></then></if>
		<if><not><isset property="save"/></not><then><property name="save" value="false"/></then></if>

		<if><not><isset property="registry.host"/></not><then><property name="registry.host" value=""/></then></if>
		<if><not><isset property="registry.port"/></not><then><property name="registry.port" value=""/></then></if>		
		
		<if><not><isset property="naming.mode"/></not><then><property name="naming.mode" value=""/></then></if>
		<if><not><isset property="db.type"/></not><then><property name="db.type" value=""/></then></if>
		<if><not><isset property="db.host"/></not><then><property name="db.host" value=""/></then></if>
		<if><not><isset property="db.port"/></not><then><property name="db.port" value=""/></then></if>			
		<if><not><isset property="db.dir"/></not><then><property name="db.dir" value=""/></then></if>		
		<if><not><isset property="db.name"/></not><then><property name="db.name" value=""/></then></if>		
		<if><not><isset property="db.user"/></not><then><property name="db.user" value=""/></then></if>
		<if><not><isset property="db.password"/></not><then><property name="db.password" value=""/></then></if>
		
		<if><not><isset property="selfish"/></not><then><property name="selfish" value=""/></then></if>
		<if><not><isset property="use.default.libs"/></not><then><property name="use.default.libs" value=""/></then></if>
		
		<if><not><isset property="preprocess.help"/></not><then><property name="preprocess.help" value=""/></then></if>
		<if><not><isset property="r.options"/></not><then><property name="r.options" value=""/></then></if>
		
		<if><not><isset property="noconfirmation"/></not><then><property name="noconfirmation" value="false"/></then></if>
		<if><not><isset property="gui_url"/></not><then><property name="gui_url" value=""/></then></if>
		<if><not><isset property="gui_name"/></not><then><property name="gui_name" value=""/></then></if>
		<if><not><isset property="gui_selector"/></not><then><property name="gui_selector" value=""/></then></if>

		<java  maxmemory="1024m" classname="org.kchine.r.workbench.WorkbenchLauncher"
			fork="true" spawn="${spawn}">
			<classpath>
				
				<pathelement path="${CORE_JAR}"/>
				<pathelement path="${JRI_JAR}"/>				
				<pathelement path="${HTMLPARSER_JAR}"/>
				<pathelement path="${SSH_JAR}"/>
				<pathelement path="${SSH_TUNNEL_JAR}"/>
				<pathelement path="${FTP_JAR}"/>
				
				<pathelement path="lib/desktop/jsp-api-2.1.jar"/>
				<pathelement path="lib/desktop/jsp-2.1.jar"/>
								
				<pathelement path="${JETTY_JAR}"/>
				<pathelement path="${JETTY_UTIL_JAR}"/>
				<pathelement path="${JETTY_CLIENT_JAR}"/>
				<pathelement path="${JETTY_SERVLET_API_JAR}"/>
				
				<pathelement path="lib/desktop/activation.jar"/>
				<pathelement path="lib/desktop/mail.jar"/>
				<pathelement path="lib/desktop/jython.jar"/>
				<pathelement path="lib/desktop/swing-layout-1.0.3.jar"/>
				<pathelement path="lib/desktop/freemindbrowser.jar"/>
				<pathelement path="lib/desktop/biocep-doc.jar"/>
				


				<pathelement path="lib/desktop/OpenXLS.jar"/>
				<pathelement path="lib/desktop/pf-joi-full.jar"/>
				<pathelement path="lib/desktop/idw-gpl.jar"/>
				<pathelement path="lib/desktop/PDFRenderer.jar"/>
				
				
				<pathelement path="${ORACLE_JAR}"/>
				<pathelement path="${MYSQL_JAR}"/>
				<pathelement path="${DERBY_JAR}"/>
				
				<pathelement path="${LOGGING_JAR}"/>
				<pathelement path="${LOG4J_JAR}"/>
				<pathelement path="lib/j2ee/commons-codec-1.3.jar"/>
				<pathelement path="lib/j2ee/commons-httpclient-3.1-rc1.jar"/>
								
				<pathelement path="${GROOVY_JAR}"/>
				
				<pathelement path="lib/svg/batik-anim.jar"/>
				<pathelement path="lib/svg/batik-awt-util.jar"/>
				<pathelement path="lib/svg/batik-bridge.jar"/>
				<pathelement path="lib/svg/batik-css.jar"/>
				<pathelement path="lib/svg/batik-dom.jar"/>
				<pathelement path="lib/svg/batik-ext.jar"/>
				<pathelement path="lib/svg/batik-extension.jar"/>
				<pathelement path="lib/svg/batik-gui-util.jar"/>
				<pathelement path="lib/svg/batik-gvt.jar"/>
				<pathelement path="lib/svg/batik-parser.jar"/>
				<pathelement path="lib/svg/batik-script.jar"/>
				<pathelement path="lib/svg/batik-svg-dom.jar"/>
				<pathelement path="lib/svg/batik-svggen.jar"/>
				<pathelement path="lib/svg/batik-swing.jar"/>
				<pathelement path="lib/svg/batik-util.jar"/>
				<pathelement path="lib/svg/batik-xml.jar"/>
				<pathelement path="lib/svg/js.jar"/>
				<pathelement path="lib/svg/xml-apis.jar"/>
				<pathelement path="lib/svg/xml-apis-ext.jar"/>				
				
				<!--
				<pathelement path="VirtualRWorkbench/distrib/mapping.jar"/>
				-->
				
			</classpath>
			

			<env key="PATH" path="${R_LIB_PATH}${path.separator}${SYSTEM_PATH}"/>
			<env key="LD_LIBRARY_PATH" path="${R_LIB_PATH}"/>
			<jvmarg value="-Djava.library.path=${JRI_LIB_PATH}"/>
			<jvmarg	value="-Dworking.dir.root=${basedir}/VirtualRWorkbench/wdir"/>
			<jvmarg value="-Dpreprocess.help=true"/>
			<jvmarg value="-Dapply.sandbox=false"/>
			
			<jvmarg value="-Dselfish=${selfish}"/>
			
			<jvmarg value="-Dmode=${mode}"/>
			<jvmarg value="-Dautologon=true"/>
			<jvmarg value="-Durl=${url}"/>
			<jvmarg value="-Dlf=${lf}"/>
			<jvmarg value="-Dstub=${stub}"/>
			<jvmarg value="-Dname=${name}"/>
			<jvmarg value="-Dsave=${save}" />
			<jvmarg value="-Dlocaltomcat.port=${localtomcat.port}"/>
			
			<jvmarg value="-Dregistry.host=${registry.host}"/>
			<jvmarg value="-Dregistry.port=${registry.port}"/>
			
			<jvmarg value="-Dnaming.mode=${naming.mode}"/>
			<jvmarg value="-Ddb.type=${db.type}"/>
			<jvmarg value="-Ddb.host=${db.host}"/>
			<jvmarg value="-Ddb.port=${db.port}"/>
			<jvmarg value="-Ddb.dir=${db.dir}"/>
			<jvmarg value="-Ddb.name=${db.name}"/>			
			<jvmarg value="-Ddb.user=${db.user}"/>
			<jvmarg value="-Ddb.password=${db.password}"/>			
			
			
			<jvmarg value="-Duse.default.libs=${use.default.libs}"/>
			<jvmarg value="-Dpreprocess.help=${preprocess.help}"/>
			<jvmarg value="-Dr.options=${r.options}"/>
			
			<jvmarg value="-Dnoconfirmation=${noconfirmation}"/>
			<jvmarg value="-Dgui_url=${gui_url}"/>
			<jvmarg value="-Dgui_name=${gui_name}"/>
			<jvmarg value="-Dgui_selector=${gui_selector}"/>
			
			<jvmarg	value="-Dorg.apache.commons.logging.Log=org.apache.commons.logging.impl.Log4JLogger"/>
			<jvmarg value="-Dlog4j.rootCategory=INFO,A1"/>
			<jvmarg	value="-Dlog4j.appender.A1=org.apache.log4j.ConsoleAppender"/>
			<jvmarg	value="-Dlog4j.appender.A1.layout=org.apache.log4j.PatternLayout"/>
			<jvmarg	value="-Dlog4j.appender.A1.layout.ConversionPattern= [%-5p] - %m%n"/>
			
		</java>
	</target>

	
	
	<target name="httpserver" depends="initializeProperties,compile">
		

		<if><not><isset property="naming.mode"/></not><then><property name="naming.mode" value=""/></then></if>
		<if><not><isset property="soapenabled"/></not><then><property name="soapenabled" value=""/></then></if>
		<if><not><isset property="port"/></not><then><property name="port" value=""/></then></if>
		
		<java maxmemory="256m" classname="HttpServerLight"
			fork="true" spawn="${spawn}" >
			
			<classpath>
				
				
				<pathelement path="${RPF_JAR}"/>
				<pathelement path="${CORE_JAR}"/>
				
				<pathelement path="${ORACLE_JAR}"/>
				<pathelement path="${MYSQL_JAR}"/>
				<pathelement path="${DERBY_JAR}"/>
								
				<pathelement path="${JRI_JAR}"/>
				<pathelement path="${LOGGING_JAR}"/>
				<pathelement path="${LOG4J_JAR}"/>
				<pathelement path="${HTMLPARSER_JAR}"/>
				<pathelement path="${SSH_JAR}"/>
				<pathelement path="${SSH_TUNNEL_JAR}"/>
				<pathelement path="${FTP_JAR}"/>		
				
				<pathelement path="lib/desktop/jsp-api-2.1.jar"/>
				<pathelement path="lib/desktop/jsp-2.1.jar"/>
				
				<pathelement path="${JETTY_JAR}"/>
				<pathelement path="${JETTY_UTIL_JAR}"/>
				<pathelement path="${JETTY_CLIENT_JAR}"/>
				<pathelement path="${JETTY_SERVLET_API_JAR}"/>
				
				<pathelement path="lib/desktop/activation.jar"/>
				<pathelement path="lib/desktop/mail.jar"/>					
				<pathelement path="lib/desktop/jython.jar"/>
				<pathelement path="lib/j2ee/commons-codec-1.3.jar"/>
				<pathelement path="lib/j2ee/commons-httpclient-3.1-rc1.jar"/>	
				
				<pathelement path="lib/svg/batik-svggen.jar"/>
				<pathelement path="lib/svg/batik-dom.jar"/>
				<pathelement path="lib/svg/batik-awt-util.jar"/>
				<pathelement path="lib/svg/batik-util.jar"/>
				
				<pathelement path="lib/pool/commons-pool-1.3.jar"/>
				
				<pathelement path="${GROOVY_JAR}"/>

				
			</classpath>
			
			
			<jvmarg	value="-Djava.library.path=${JRI_LIB_PATH}"/>
			
						
			<!-- LOG PARAMS -->
			<jvmarg	value="-Dorg.apache.commons.logging.Log=org.apache.commons.logging.impl.Log4JLogger"/>
			<jvmarg value="-Dlog4j.rootCategory=INFO,A1,A2"/>
			<jvmarg value="-Dlog4j.appender.A1=org.apache.log4j.ConsoleAppender"/>
			<jvmarg	value="-Dlog4j.appender.A1.layout=org.apache.log4j.PatternLayout"/>
			<jvmarg	value="-Dlog4j.appender.A1.layout.ConversionPattern= [%-5p] - %m%n"/>
			<jvmarg	value="-Dlog4j.appender.A2=org.kchine.rpf.RemoteAppender"/>
			<jvmarg	value="-Dlog4j.appender.A2.layout=org.apache.log4j.PatternLayout"/>
			<jvmarg	value="-Dlog4j.appender.A2.layout.ConversionPattern= [%-5p] - %m%n"/>
			
			<jvmarg value="-Dnaming.mode=${naming.mode}"/>
			<jvmarg value="-Dsoapenabled=${soapenabled}"/>
			<jvmarg value="-Dport=${port}"/>
				
			
		</java>
		
	</target>

	<target name="sshworker" depends="initializeProperties,compile">
		
		<if><not><isset property="spawn"/></not><then><property name="spawn" value="false"/></then></if>
		
		<if><not><isset property="naming.mode"/></not><then><property name="naming.mode" value=""/></then></if>
		<if><not><isset property="db.type"/></not><then><property name="db.type" value=""/></then></if>
		<if><not><isset property="db.host"/></not><then><property name="db.host" value=""/></then></if>
		<if><not><isset property="db.port"/></not><then><property name="db.port" value=""/></then></if>
		<if><not><isset property="db.name"/></not><then><property name="db.name" value=""/></then></if>		
		<if><not><isset property="db.user"/></not><then><property name="db.user" value=""/></then></if>
		<if><not><isset property="db.password"/></not><then><property name="db.password" value=""/></then></if>
			
		<java maxmemory="128m" classname="org.kchine.rpf.SSHTunnelingWorker"
			fork="true" spawn="${spawn}">
			
			<classpath>
				<pathelement path="${RPF_JAR}"/>				
				<pathelement path="${DERBY_JAR}"/>								
				<pathelement path="${LOGGING_JAR}"/>
				<pathelement path="${LOG4J_JAR}"/>
				<pathelement path="${SSH_JAR}"/>
				<pathelement path="${SSH_TUNNEL_JAR}"/>
				<pathelement path="lib/pool/commons-pool-1.3.jar"/>				
			</classpath>
			
			<jvmarg value="-Dnaming.mode=${naming.mode}"/>
			<jvmarg value="-Ddb.type=${db.type}"/>
			<jvmarg value="-Ddb.host=${db.host}"/>
			<jvmarg value="-Ddb.port=${db.port}"/>
			<jvmarg value="-Ddb.dir=${db.dir}"/>
			<jvmarg value="-Ddb.name=${db.name}"/>			
			<jvmarg value="-Ddb.user=${db.user}"/>
			<jvmarg value="-Ddb.password=${db.password}"/>			
			
			<jvmarg value="-Dproperties.extension=${properties.extension}"/>
			
			<jvmarg	value="-Dorg.apache.commons.logging.Log=org.apache.commons.logging.impl.Log4JLogger"/>
			<jvmarg value="-Dlog4j.rootCategory=INFO,A1,A2"/>
			<jvmarg value="-Dlog4j.appender.A1=org.apache.log4j.ConsoleAppender"/>
			<jvmarg	value="-Dlog4j.appender.A1.layout=org.apache.log4j.PatternLayout"/>
			<jvmarg	value="-Dlog4j.appender.A1.layout.ConversionPattern= [%-5p] - %m%n"/>
			<jvmarg	value="-Dlog4j.appender.A2=org.kchine.rpf.RemoteAppender"/>
			<jvmarg	value="-Dlog4j.appender.A2.layout=org.apache.log4j.PatternLayout"/>
			<jvmarg	value="-Dlog4j.appender.A2.layout.ConversionPattern= [%-5p] - %m%n"/>
			
		</java>
		
	</target>

	
	
	<target name="s" depends="initializeProperties,compile">
		
			
		<if><not><isset property="spawn"/></not><then><property name="spawn" value="false"/></then></if>
		<if><not><isset property="lf"/></not><then><property name="lf" value="0"/></then></if>
		<if><not><isset property="mode"/></not><then><property name="mode" value="local"/></then></if>
		<if><not><isset property="stub"/></not><then><property name="stub" value=""/></then></if>				
		<if><not><isset property="localtomcat.port"/></not><then><property name="localtomcat.port" value="9999"/></then></if>
		<if><not><isset property="url"/></not><then><property name="url" value=""/></then></if>
		<if><not><isset property="name"/></not><then><property name="name" value=""/></then></if>
		<if><not><isset property="save"/></not><then><property name="save" value="true"/></then></if>

		<if><not><isset property="registry.host"/></not><then><property name="registry.host" value=""/></then></if>
		<if><not><isset property="registry.port"/></not><then><property name="registry.port" value=""/></then></if>
		
		
		<if><not><isset property="naming.mode"/></not><then><property name="naming.mode" value=""/></then></if>
		<if><not><isset property="db.type"/></not><then><property name="db.type" value=""/></then></if>
		<if><not><isset property="db.host"/></not><then><property name="db.host" value=""/></then></if>
		<if><not><isset property="db.port"/></not><then><property name="db.port" value=""/></then></if>
		<if><not><isset property="db.dir"/></not><then><property name="db.dir" value=""/></then></if>
		<if><not><isset property="db.name"/></not><then><property name="db.name" value=""/></then></if>		
		<if><not><isset property="db.user"/></not><then><property name="db.user" value=""/></then></if>
		<if><not><isset property="db.password"/></not><then><property name="db.password" value=""/></then></if>

		<java maxmemory="1024m" classname="server.ServerManager"
			fork="true" spawn="${spawn}">
			<classpath>
				
				<pathelement path="${CORE_JAR}"/>
				<pathelement path="${JRI_JAR}"/>				
				<pathelement path="${HTMLPARSER_JAR}"/>
				<pathelement path="${SSH_JAR}"/>
				<pathelement path="${SSH_TUNNEL_JAR}"/>
				<pathelement path="${FTP_JAR}"/>
	
				<pathelement path="lib/desktop/OpenXLS.jar"/>
				<pathelement path="lib/desktop/pf-joi-full.jar"/>
				<pathelement path="lib/desktop/idw-gpl.jar"/>
				<pathelement path="lib/desktop/PDFRenderer.jar"/>
				
				<pathelement path="lib/desktop/jsp-api-2.1.jar"/>
				<pathelement path="lib/desktop/jsp-2.1.jar"/>
				
				<pathelement path="${JETTY_JAR}"/>
				<pathelement path="${JETTY_UTIL_JAR}"/>
				<pathelement path="${JETTY_CLIENT_JAR}"/>
				<pathelement path="${JETTY_SERVLET_API_JAR}"/>
				
				
				<pathelement path="lib/desktop/activation.jar"/>
				<pathelement path="lib/desktop/mail.jar"/>
				<pathelement path="lib/desktop/jython.jar"/>
				<pathelement path="lib/desktop/swing-layout-1.0.3.jar"/>
				<pathelement path="lib/desktop/freemindbrowser.jar"/>
				<pathelement path="lib/desktop/biocep-doc.jar"/>

				<pathelement path="lib/svg/batik-anim.jar"/>
				<pathelement path="lib/svg/batik-awt-util.jar"/>
				<pathelement path="lib/svg/batik-bridge.jar"/>
				<pathelement path="lib/svg/batik-css.jar"/>
				<pathelement path="lib/svg/batik-dom.jar"/>
				<pathelement path="lib/svg/batik-ext.jar"/>
				<pathelement path="lib/svg/batik-extension.jar"/>
				<pathelement path="lib/svg/batik-gui-util.jar"/>
				<pathelement path="lib/svg/batik-gvt.jar"/>
				<pathelement path="lib/svg/batik-parser.jar"/>
				<pathelement path="lib/svg/batik-script.jar"/>
				<pathelement path="lib/svg/batik-svg-dom.jar"/>
				<pathelement path="lib/svg/batik-svggen.jar"/>
				<pathelement path="lib/svg/batik-swing.jar"/>
				<pathelement path="lib/svg/batik-util.jar"/>
				<pathelement path="lib/svg/batik-xml.jar"/>
				<pathelement path="lib/svg/js.jar"/>
				<pathelement path="lib/svg/xml-apis.jar"/>
				<pathelement path="lib/svg/xml-apis-ext.jar"/>				
				
				<pathelement path="${ORACLE_JAR}"/>
				<pathelement path="${MYSQL_JAR}"/>
				<pathelement path="${DERBY_JAR}"/>
				
				<pathelement path="${LOGGING_JAR}"/>
				<pathelement path="${LOG4J_JAR}"/>
				<pathelement path="lib/j2ee/commons-codec-1.3.jar"/>
				<pathelement path="lib/j2ee/commons-httpclient-3.1-rc1.jar"/>
				
				<pathelement path="lib/pool/commons-pool-1.3.jar"/>
				<!--optional-->
				<pathelement path="VirtualRWorkbench/distrib/mapping.jar"/>
				
			</classpath>
			
			<env key="PATH" path="${SYSTEM_PATH}${path.separator}${R_LIB_PATH}"/>
			<env key="LD_LIBRARY_PATH" path="${R_LIB_PATH}"/>
			<jvmarg value="-Djava.library.path=${JRI_LIB_PATH}"/>
			<jvmarg	value="-Dworking.dir.root=${basedir}/VirtualRWorkbench/wdir"/>
			<jvmarg value="-Dpreprocess.help=true"/>
			<jvmarg value="-Dapply.sandbox=false"/>
			
			<jvmarg value="-Dmode=${mode}"/>
			<jvmarg value="-Dautologon=true"/>
			<jvmarg value="-Durl=${url}"/>
			<jvmarg value="-Dlf=${lf}"/>
			<jvmarg value="-Dstub=${stub}"/>
			<jvmarg value="-Dname=${name}"/>
			<jvmarg value="-Dsave=${save}" />
			<jvmarg value="-Dlocaltomcat.port=${localtomcat.port}"/>
			
			<jvmarg value="-Dregistry.host=${registry.host}"/>
			<jvmarg value="-Dregistry.port=${registry.port}"/>
			
			<jvmarg value="-Dnaming.mode=${naming.mode}"/>
			<jvmarg value="-Ddb.type=${db.type}"/>
			<jvmarg value="-Ddb.host=${db.host}"/>
			<jvmarg value="-Ddb.port=${db.port}"/>
			<jvmarg value="-Ddb.dir=${db.dir}"/>
			<jvmarg value="-Ddb.name=${db.name}"/>			
			<jvmarg value="-Ddb.user=${db.user}"/>
			<jvmarg value="-Ddb.password=${db.password}"/>

			
			
			<jvmarg	value="-Dorg.apache.commons.logging.Log=org.apache.commons.logging.impl.Log4JLogger"/>
			<jvmarg value="-Dlog4j.rootCategory=INFO,A1"/>
			<jvmarg	value="-Dlog4j.appender.A1=org.apache.log4j.ConsoleAppender"/>
			<jvmarg	value="-Dlog4j.appender.A1.layout=org.apache.log4j.PatternLayout"/>
			<jvmarg	value="-Dlog4j.appender.A1.layout.ConversionPattern= [%-5p] - %m%n"/>
			
		</java>
	</target>
	

	<target name="t" depends="initializeProperties,compile">
			
				
			<if><not><isset property="spawn"/></not><then><property name="spawn" value="false"/></then></if>
			<if><not><isset property="lf"/></not><then><property name="lf" value="0"/></then></if>
			<if><not><isset property="mode"/></not><then><property name="mode" value="local"/></then></if>
			<if><not><isset property="stub"/></not><then><property name="stub" value=""/></then></if>				
			<if><not><isset property="localtomcat.port"/></not><then><property name="localtomcat.port" value="9999"/></then></if>
			<if><not><isset property="url"/></not><then><property name="url" value=""/></then></if>
			<if><not><isset property="name"/></not><then><property name="name" value=""/></then></if>
			<if><not><isset property="save"/></not><then><property name="save" value="true"/></then></if>

			<if><not><isset property="registry.host"/></not><then><property name="registry.host" value=""/></then></if>
			<if><not><isset property="registry.port"/></not><then><property name="registry.port" value=""/></then></if>
		
		
		<if><not><isset property="naming.mode"/></not><then><property name="naming.mode" value="db"/></then></if>
		<if><not><isset property="db.type"/></not><then><property name="db.type" value=""/></then></if>
		<if><not><isset property="db.host"/></not><then><property name="db.host" value=""/></then></if>
		<if><not><isset property="db.port"/></not><then><property name="db.port" value=""/></then></if>
		<if><not><isset property="db.dir"/></not><then><property name="db.dir" value=""/></then></if>
		<if><not><isset property="db.name"/></not><then><property name="db.name" value=""/></then></if>		
		<if><not><isset property="db.user"/></not><then><property name="db.user" value=""/></then></if>
		<if><not><isset property="db.password"/></not><then><property name="db.password" value=""/></then></if>								

			<java maxmemory="1024m" classname="server.SendEmailMain"
				fork="true" spawn="${spawn}">
				<classpath>
					
					<pathelement path="${CORE_JAR}"/>
					<pathelement path="${JRI_JAR}"/>				
					<pathelement path="${HTMLPARSER_JAR}"/>
					<pathelement path="${SSH_JAR}"/>
					<pathelement path="${SSH_TUNNEL_JAR}"/>
					<pathelement path="${FTP_JAR}"/>
		
					<pathelement path="lib/desktop/OpenXLS.jar"/>
					<pathelement path="lib/desktop/pf-joi-full.jar"/>
					<pathelement path="lib/desktop/idw-gpl.jar"/>
					<pathelement path="lib/desktop/PDFRenderer.jar"/>
					
					<pathelement path="lib/desktop/jsp-api-2.1.jar"/>
					<pathelement path="lib/desktop/jsp-2.1.jar"/>
					
					
					<pathelement path="${JETTY_JAR}"/>
					<pathelement path="${JETTY_UTIL_JAR}"/>
					<pathelement path="${JETTY_CLIENT_JAR}"/>
					<pathelement path="${JETTY_SERVLET_API_JAR}"/>
					
					
					<pathelement path="lib/desktop/activation.jar"/>
					<pathelement path="lib/desktop/mail.jar"/>
					<pathelement path="lib/desktop/jython.jar"/>
					<pathelement path="lib/desktop/swing-layout-1.0.3.jar"/>
					<pathelement path="lib/desktop/freemindbrowser.jar"/>
					<pathelement path="lib/desktop/biocep-doc.jar"/>

					<pathelement path="lib/svg/batik-anim.jar"/>
					<pathelement path="lib/svg/batik-awt-util.jar"/>
					<pathelement path="lib/svg/batik-bridge.jar"/>
					<pathelement path="lib/svg/batik-css.jar"/>
					<pathelement path="lib/svg/batik-dom.jar"/>
					<pathelement path="lib/svg/batik-ext.jar"/>
					<pathelement path="lib/svg/batik-extension.jar"/>
					<pathelement path="lib/svg/batik-gui-util.jar"/>
					<pathelement path="lib/svg/batik-gvt.jar"/>
					<pathelement path="lib/svg/batik-parser.jar"/>
					<pathelement path="lib/svg/batik-script.jar"/>
					<pathelement path="lib/svg/batik-svg-dom.jar"/>
					<pathelement path="lib/svg/batik-svggen.jar"/>
					<pathelement path="lib/svg/batik-swing.jar"/>
					<pathelement path="lib/svg/batik-util.jar"/>
					<pathelement path="lib/svg/batik-xml.jar"/>
					<pathelement path="lib/svg/js.jar"/>
					<pathelement path="lib/svg/xml-apis.jar"/>
					<pathelement path="lib/svg/xml-apis-ext.jar"/>				
					
					<pathelement path="${ORACLE_JAR}"/>
					<pathelement path="${MYSQL_JAR}"/>
					<pathelement path="${DERBY_JAR}"/>
					
					<pathelement path="${LOGGING_JAR}"/>
					<pathelement path="${LOG4J_JAR}"/>
					<pathelement path="lib/j2ee/commons-codec-1.3.jar"/>
					<pathelement path="lib/j2ee/commons-httpclient-3.1-rc1.jar"/>
					
					<!--optional-->
					<pathelement path="VirtualRWorkbench/distrib/mapping.jar"/>
					
				</classpath>
				
				<env key="PATH" path="${R_LIB_PATH}"/>
				<env key="LD_LIBRARY_PATH" path="${R_LIB_PATH}"/>
				<jvmarg value="-Djava.library.path=${JRI_LIB_PATH}"/>
				<jvmarg	value="-Dworking.dir.root=${basedir}/VirtualRWorkbench/wdir"/>
				<jvmarg value="-Dpreprocess.help=true"/>
				<jvmarg value="-Dapply.sandbox=false"/>
				
				<jvmarg value="-Dmode=${mode}"/>
				<jvmarg value="-Dautologon=true"/>
				<jvmarg value="-Durl=${url}"/>
				<jvmarg value="-Dlf=${lf}"/>
				<jvmarg value="-Dstub=${stub}"/>
				<jvmarg value="-Dname=${name}"/>
				<jvmarg value="-Dsave=${save}" />
				<jvmarg value="-Dlocaltomcat.port=${localtomcat.port}"/>
				
				<jvmarg value="-Dregistry.host=${registry.host}"/>
				<jvmarg value="-Dregistry.port=${registry.port}"/>
				
				<jvmarg value="-Dnaming.mode=${naming.mode}"/>
				<jvmarg value="-Ddb.type=${db.type}"/>
				<jvmarg value="-Ddb.host=${db.host}"/>
				<jvmarg value="-Ddb.port=${db.port}"/>
				<jvmarg value="-Ddb.dir=${db.dir}"/>
				<jvmarg value="-Ddb.name=${db.name}"/>			
				<jvmarg value="-Ddb.user=${db.user}"/>
				<jvmarg value="-Ddb.password=${db.password}"/>
				
				<jvmarg	value="-Dorg.apache.commons.logging.Log=org.apache.commons.logging.impl.Log4JLogger"/>
				<jvmarg value="-Dlog4j.rootCategory=INFO,A1"/>
				<jvmarg	value="-Dlog4j.appender.A1=org.apache.log4j.ConsoleAppender"/>
				<jvmarg	value="-Dlog4j.appender.A1.layout=org.apache.log4j.PatternLayout"/>
				<jvmarg	value="-Dlog4j.appender.A1.layout.ConversionPattern= [%-5p] - %m%n"/>
				
				
				<jvmarg value="-Djava.rmi.server.codebase=file://${windows.root.slash}${CORE_JAR} file://${windows.root.slash}${demo.mappingjar}"/>
				
			</java>
		</target>

	
	<target name="demoserver" depends="initializeProperties,compile">
		<antcall target="server">			
			<param name="servant.classpath" value="${JRI_JAR}${path.separator}${CORE_JAR}"/>
			<param name="servant.codebase" value="file://${windows.root.slash}${basedir}/${CORE_JAR}"/>
			<param name="working.dir.root" value="${basedir}/VirtualRWorkbench/wdir"/>
			<param name="servantclass" value="org.kchine.r.server.impl.RServantImpl"/>											
			
		</antcall>		
	</target>
	
	
	<target name="killdb"  depends="initializeProperties" >
		
		<if><not><isset property="naming.mode"/></not><then><property name="naming.mode" value=""/></then></if>
		<if><not><isset property="db.type"/></not><then><property name="db.type" value=""/></then></if>
		<if><not><isset property="db.host"/></not><then><property name="db.host" value=""/></then></if>
		<if><not><isset property="db.port"/></not><then><property name="db.port" value=""/></then></if>
		<if><not><isset property="db.dir"/></not><then><property name="db.dir" value=""/></then></if>
		<if><not><isset property="db.name"/></not><then><property name="db.name" value=""/></then></if>		
		<if><not><isset property="db.user"/></not><then><property name="db.user" value=""/></then></if>
		<if><not><isset property="db.password"/></not><then><property name="db.password" value=""/></then></if>		
		
		<if><not><isset property="db.initscript"/></not><then><property name="db.initscript" value=""/></then></if>		
	
		<java classname="org.kchine.rpf.db.KillAllDB" fork="true">
			<classpath>
				<pathelement path="${CORE_JAR}"/>
				<pathelement path="${LOGGING_JAR}"/>
				<pathelement path="${LOG4J_JAR}"/>
				<pathelement path="${ORACLE_JAR}"/>
				<pathelement path="${MYSQL_JAR}"/>
				<pathelement path="${DERBY_JAR}"/>
				<pathelement path="${SSH_JAR}"/>
				<pathelement path="${SSH_TUNNEL_JAR}"/>				
			</classpath>
			
			
			<jvmarg value="-Dnaming.mode=${naming.mode}"/>
			<jvmarg value="-Ddb.type=${db.type}"/>
			<jvmarg value="-Ddb.host=${db.host}"/>
			<jvmarg value="-Ddb.port=${db.port}"/>
			<jvmarg value="-Ddb.dir=${db.dir}"/>
			<jvmarg value="-Ddb.name=${db.name}"/>			
			<jvmarg value="-Ddb.user=${db.user}"/>
			<jvmarg value="-Ddb.password=${db.password}"/>
			
			
			<jvmarg value="-Ddb.initscript=${db.initscript}"/>
			<jvmarg	value="-Dorg.apache.commons.logging.Log=org.apache.commons.logging.impl.Log4JLogger"/>
			<jvmarg value="-Dlog4j.rootCategory=INFO,A1"/>
			<jvmarg value="-Dlog4j.appender.A1=org.apache.log4j.ConsoleAppender"/>
			<jvmarg value="-Dlog4j.appender.A1.layout=org.apache.log4j.PatternLayout"/>
			<jvmarg value="-Dlog4j.appender.A1.layout.ConversionPattern= [%-5p] - %m%n"/>
		</java>
	</target>
	
	<target name="killall"  depends="initializeProperties" >
		
		<if><not><isset property="registry.host"/></not><then><property name="registry.host" value=""/></then></if>
		<if><not><isset property="registry.port"/></not><then><property name="registry.port" value=""/></then></if>
		<if><not><isset property="prefix"/></not><then><property name="prefix" value=""/></then></if>
		
		
		<if><not><isset property="naming.mode"/></not><then><property name="naming.mode" value=""/></then></if>
		<if><not><isset property="db.type"/></not><then><property name="db.type" value=""/></then></if>
		<if><not><isset property="db.host"/></not><then><property name="db.host" value=""/></then></if>
		<if><not><isset property="db.port"/></not><then><property name="db.port" value=""/></then></if>
		<if><not><isset property="db.dir"/></not><then><property name="db.dir" value=""/></then></if>
		<if><not><isset property="db.name"/></not><then><property name="db.name" value=""/></then></if>		
		<if><not><isset property="db.user"/></not><then><property name="db.user" value=""/></then></if>
		<if><not><isset property="db.password"/></not><then><property name="db.password" value=""/></then></if>
			
			
		<if><not><isset property="stub"/></not><then><property name="stub" value=""/></then></if>
		
		<java classname="org.kchine.rpf.KillAll" fork="true">
			<classpath>
				<pathelement path="${CORE_JAR}"/>
				<pathelement path="${LOGGING_JAR}"/>
				<pathelement path="${LOG4J_JAR}"/>
				<pathelement path="${ORACLE_JAR}"/>
				<pathelement path="${MYSQL_JAR}"/>
				<pathelement path="${DERBY_JAR}"/>
			</classpath>
			<jvmarg value="-Djava.rmi.server.codebase=file:///${CORE_JAR}"/>
			
			<jvmarg value="-Dstub=${stub}"/>
			
			<jvmarg value="-Dregistry.host=${registry.host}"/>
			<jvmarg value="-Dregistry.port=${registry.port}"/>
			<jvmarg value="-Dprefix=${prefix}"/>
			
			<jvmarg value="-Dnaming.mode=${naming.mode}"/>
			<jvmarg value="-Ddb.type=${db.type}"/>
			<jvmarg value="-Ddb.host=${db.host}"/>
			<jvmarg value="-Ddb.port=${db.port}"/>
			<jvmarg value="-Ddb.dir=${db.dir}"/>
			<jvmarg value="-Ddb.name=${db.name}"/>			
			<jvmarg value="-Ddb.user=${db.user}"/>
			<jvmarg value="-Ddb.password=${db.password}"/>

			
			<jvmarg	value="-Dorg.apache.commons.logging.Log=org.apache.commons.logging.impl.Log4JLogger"/>
			<jvmarg value="-Dlog4j.rootCategory=INFO,A1"/>
			<jvmarg	value="-Dlog4j.appender.A1=org.apache.log4j.ConsoleAppender"/>
			<jvmarg	value="-Dlog4j.appender.A1.layout=org.apache.log4j.PatternLayout"/>
			<jvmarg	value="-Dlog4j.appender.A1.layout.ConversionPattern= [%-5p] - %m%n"/>
			
		</java>
	</target>
	
	<target name="clean"  depends="initializeProperties" >
		<delete dir="bin" failonerror="true"/>
		<mkdir dir="bin"/>
		
		<delete dir="binrpf" failonerror="true"/>
		<mkdir dir="binrpf"/>
		
		<delete dir="binsrv" failonerror="true"/>
		<mkdir dir="binsrv"/>


		<delete>
			<fileset dir="demos">
				<include name="**/*.class"/>
			</fileset>
		</delete>
		
		<delete>
			
			<fileset dir=".">
				<include name="*.jar"/>
			</fileset>
		</delete>
	</target>

	<target name="srv"  depends="initializeProperties">
		<echo message="${basedir}"/>
		
		<property 
			name="src_srv_target" 
			value="src_rpf_common:src_client:src_server_common:src_patch_rJava:src_patch_JavaGD:src_patch_joi"/>
		
		<javac
			srcdir="${src_srv_target}"
			destdir="binsrv" debug="true" source="1.5" target="1.5">
			<classpath>
				<pathelement path="${JRI_JAR}"/>
				<fileset dir="lib">
					<include name="**/*.jar"/>
				</fileset>
			</classpath>
		</javac>
		
		<for list="${src_srv_target}" param="source" delimiter=":">
		  <sequential>
			<copy todir="binsrv">				
				<fileset dir="@{source}">
					<include name="**/*.xml"/>
					<include name="**/*.props"/>
					<include name="**/*.properties"/>
					<include name="**/*.R"/>
					<include name="**/*.r"/>
					<include name="**/*.png"/>
					<include name="**/*.gif"/>
					<include name="**/*.html"/>
					<include name="**/*.exe"/>
					<include name="**/*.jar"/>
				</fileset>				
			</copy>
		  </sequential>
		</for>
				
		
		<jar destfile="${SRV_JAR}">
			<fileset dir="binsrv"/>
		</jar>
		
		
	</target>
	
	
	<target name="distrib"  depends="initializeProperties">
		
		
			<delete dir="binsrv" failonerror="true"/>
			<mkdir dir="binsrv"/>

			<property 
				name="src_srv_target" value="src_rpf_common:src_rpf:src_server_common:src_server:src_patch_rJava:src_patch_JavaGD:src_patch_iplots:src_scilab:src_openoffice"/>		
			<javac
				srcdir="${src_srv_target}"
				destdir="binsrv" debug="true" source="1.5" target="1.5">
				<classpath>										
					<pathelement path="${JRI_JAR}"/>
					<pathelement path="${LOGGING_JAR}"/>
					<pathelement path="${LOG4J_JAR}"/>
					<pathelement path="${HTMLPARSER_JAR}"/>
					<pathelement path="${SSH_JAR}"/>
					<pathelement path="${SSH_TUNNEL_JAR}"/>
					<pathelement path="${FTP_JAR}"/>
					<pathelement path="${JAVASCI_JAR}"/>
					

					<pathelement path="lib/desktop/jsp-api-2.1.jar"/>
					<pathelement path="lib/desktop/jsp-2.1.jar"/>
					
					<pathelement path="${JETTY_JAR}"/>
					<pathelement path="${JETTY_UTIL_JAR}"/>
					<pathelement path="${JETTY_CLIENT_JAR}"/>
					<pathelement path="${JETTY_SERVLET_API_JAR}"/>					
					
					<pathelement path="lib/desktop/activation.jar"/>
					<pathelement path="lib/desktop/mail.jar"/>					
					<pathelement path="lib/desktop/jython.jar"/>
					
					<pathelement path="lib/j2ee/commons-codec-1.3.jar"/>
					<pathelement path="lib/j2ee/commons-httpclient-3.1-rc1.jar"/>	
					
					<pathelement path="lib/svg/batik-svggen.jar"/>
					<pathelement path="lib/svg/batik-dom.jar"/>
					<pathelement path="lib/svg/batik-awt-util.jar"/>
					<pathelement path="lib/svg/batik-util.jar"/>
					<pathelement path="lib/svg/batik-ext.jar"/>
					
					<pathelement path="lib/pool/commons-pool-1.3.jar"/>
				</classpath>
			</javac>
			
			<rmic classpath="binsrv" base="binsrv" classname="org.kchine.r.server.impl.RServantImpl"/>
			<rmic classpath="binsrv" base="binsrv" classname="org.kchine.r.server.impl.AssignInterfaceImpl"/>
			<rmic classpath="binsrv" base="binsrv" classname="org.kchine.r.server.impl.RNIImpl"/>
			<rmic classpath="binsrv" base="binsrv" classname="org.kchine.r.server.impl.GraphicNotifierImpl"/>
			<rmic classpath="binsrv" base="binsrv" classname="org.kchine.r.server.impl.GDDeviceImpl"/>
		
			<rmic classpath="binsrv" base="binsrv" classname="org.kchine.r.server.spreadsheet.TableModelRemoteImpl"/>
			<rmic classpath="binsrv" base="binsrv" classname="org.kchine.r.server.spreadsheet.TableModelListenerRemoteImpl"/>
			<rmic classpath="binsrv" base="binsrv" classname="org.kchine.r.server.spreadsheet.SpreadsheetModelRemoteImpl"/>
			<rmic classpath="binsrv" base="binsrv" classname="org.kchine.r.server.spreadsheet.SpreadsheetListenerRemoteImpl"/>
			<rmic classpath="binsrv" base="binsrv" classname="org.kchine.r.server.spreadsheet.SpreadsheetModelDeviceImpl"/>
				
			<rmic classpath="binsrv" base="binsrv" classname="org.rosuda.ibase.SVarSetInterfaceRemoteImpl"/>
			<rmic classpath="binsrv" base="binsrv" classname="org.rosuda.ibase.SVarInterfaceRemoteImpl"/>
			<rmic classpath="binsrv" base="binsrv" classname="org.rosuda.ibase.SMarkerInterfaceRemoteImpl"/>
			<rmic classpath="binsrv" base="binsrv" classname="org.rosuda.ibase.DependentRemoteImpl"/>
		
			<rmic classpath="binsrv" base="binsrv" classname="org.kchine.rpf.db.NodeManagerImpl"/>
				
			<for list="${src_srv_target}" param="source" delimiter=":">
			  <sequential>
				<copy todir="binsrv">				
					<fileset dir="@{source}">
						<include name="**/*.xml"/>
						<include name="**/*.props"/>
						<include name="**/*.properties"/>
						<include name="**/*.R"/>
						<include name="**/*.r"/>
						<include name="**/*.png"/>
						<include name="**/*.gif"/>
						<include name="**/*.html"/>
						<include name="**/*.exe"/>
						<include name="**/*.jar"/>
						<include name="**/*.sql"/>
					</fileset>				
				</copy>
			  </sequential>
			</for>
				
				
			<java classname="org.kchine.r.server.utils.ListResources" fork="true" >
				<classpath>
					<pathelement path="${LOGGING_JAR}"/>					
					<pathelement location="binsrv"/>					
				</classpath>					  				
				<arg value="${basedir}/binsrv"/>
			</java>	
			
			<unjar src="${JRI_JAR}"  dest="binsrv" overwrite="true"/>
			<unjar src="${LOGGING_JAR}"  dest="binsrv" overwrite="true"/>
			<unjar src="${LOG4J_JAR}"  dest="binsrv" overwrite="true"/>
			<unjar src="${HTMLPARSER_JAR}"  dest="binsrv" overwrite="true"/>
			<unjar src="${SSH_JAR}"  dest="binsrv" overwrite="true"/>
			<unjar src="${SSH_TUNNEL_JAR}"  dest="binsrv" overwrite="true"/>
			<unjar src="${FTP_JAR}"  dest="binsrv" overwrite="true"/>
					
			<unjar src="${JETTY_JAR}"  dest="binsrv" overwrite="true"/>
			<unjar src="${JETTY_UTIL_JAR}"  dest="binsrv" overwrite="true"/>
			<unjar src="${JETTY_CLIENT_JAR}"  dest="binsrv" overwrite="true"/>
		
		
			<unjar src="lib/desktop/activation.jar"  dest="binsrv" overwrite="true"/>
			<unjar src="lib/desktop/mail.jar"  dest="binsrv" overwrite="true"/>
			<unjar src="lib/desktop/jython.jar"  dest="binsrv" overwrite="true"/>
		
			<unjar src="lib/j2ee/commons-codec-1.3.jar"  dest="binsrv" overwrite="true"/>
			<unjar src="lib/j2ee/commons-httpclient-3.1-rc1.jar"  dest="binsrv" overwrite="true"/>
			<unjar src="lib/svg/batik-svggen.jar"  dest="binsrv" overwrite="true"/>
			<unjar src="lib/svg/batik-dom.jar"  dest="binsrv" overwrite="true"/>
			<unjar src="lib/svg/batik-awt-util.jar"  dest="binsrv" overwrite="true"/>
			<unjar src="lib/svg/batik-util.jar"  dest="binsrv" overwrite="true"/>
			<unjar src="lib/svg/batik-ext.jar"  dest="binsrv" overwrite="true"/>
			<unjar src="lib/svg/batik-xml.jar"  dest="binsrv" overwrite="true"/>
		
			<unjar src="lib/pool/commons-pool-1.3.jar"  dest="binsrv" overwrite="true"/>
			<unjar src="lib/jdbc/derbyclient.jar"  dest="binsrv" overwrite="true"/>
		
			<unjar src="${GROOVY_JAR}"  dest="binsrv" overwrite="true"/>
		
		
			<jar destfile="biocep-core-tomcat.jar" >
				<fileset dir="binsrv"/>
			</jar>
			
			
			
			<unjar src="${JETTY_SERVLET_API_JAR}"  dest="binsrv" overwrite="true"/>
			<unjar src="lib/desktop/jsp-api-2.1.jar"  dest="binsrv" overwrite="true"/>
			<unjar src="lib/desktop/jsp-2.1.jar"  dest="binsrv" overwrite="true"/>
						
			<manifest file="MANIFEST.MF">
				<attribute name="Built-By" value="Karim Chine"/>
				<attribute name="Main-Class" value="org.kchine.r.server.CoreMain"/>
			</manifest>		
				
			<jar destfile="biocep-core.jar" manifest="MANIFEST.MF">
				<fileset dir="binsrv"/>
			</jar>
		
			
			<signjar jar="biocep-core.jar" signedjar="biocep-core.jar" alias="appletsigningkey" keystore="keys/appletKeyStore.ks"  storepass="cloudera" />
			
			
			<!-- tools begin -->
			<!--
		
		
			<delete dir="bintools" failonerror="true"/>
			<mkdir dir="bintools"/>

			<property  name="src_tools_target" value="src_tools:src_masq"/>
		
			<javac
			srcdir="${src_tools_target}"
			destdir="bintools" debug="true" source="1.5" target="1.5">
			<classpath>					
				<pathelement location="binsrv"/>				
				<pathelement path="lib/ant/ant.jar"/>
				<pathelement path="lib/ant/ant-launcher.jar"/>
				<pathelement path="${JDK_HOME}/lib/tools.jar"/>
				<pathelement path="lib/beangenlibs/ant-contrib-1.0b3.jar"/>
				<pathelement path="lib/beangenlibs/geronimo-jms_1.1_spec-1.0.jar"/>
				<pathelement path="lib/beangenlibs/jakarta-oro-2.0.8.jar"/>
				<pathelement path="lib/beangenlibs/jakarta-regexp-1.4.jar"/>
				<pathelement path="lib/beangenlibs/jalopy-ant.jar"/>
				<pathelement path="lib/beangenlibs/jalopy.jar"/>
				<pathelement path="lib/beangenlibs/jaxws-libs.jar"/>
				<pathelement path="lib/beangenlibs/jdom.jar"/>
				
				<pathelement path="lib/jaxws/jaxws-tools.jar"/>
			</classpath>
				
	 
	
				
		</javac>
		
		
		<for list="${src_tools_target}" param="source" delimiter=":">
					  <sequential>
						<copy todir="bintools">				
							<fileset dir="@{source}">
								<include name="**/*.xml"/>
								<include name="**/*.props"/>
								<include name="**/*.properties"/>
								<include name="**/*.R"/>
								<include name="**/*.r"/>
								<include name="**/*.png"/>
								<include name="**/*.gif"/>
								<include name="**/*.html"/>
							</fileset>				
						</copy>
					  </sequential>
		</for>
		
		
		<unjar src="lib/ant/ant-launcher.jar"  dest="bintools" overwrite="true"/>
		<unjar src="lib/ant/ant.jar"  dest="bintools" overwrite="true"/>
		
		<unjar src="${JDK_HOME}/lib/tools.jar"  dest="bintools" overwrite="true"/>
			
		<unjar src="lib/beangenlibs/ant-contrib-1.0b3.jar"  dest="bintools" overwrite="true"/>
		<unjar src="lib/beangenlibs/geronimo-jms_1.1_spec-1.0.jar"  dest="bintools" overwrite="true"/>
		<unjar src="lib/beangenlibs/jakarta-oro-2.0.8.jar"  dest="bintools" overwrite="true"/>
		<unjar src="lib/beangenlibs/jakarta-regexp-1.4.jar"  dest="bintools" overwrite="true"/>	
		<unjar src="lib/beangenlibs/jalopy-ant.jar"  dest="bintools" overwrite="true"/>
		<unjar src="lib/beangenlibs/jalopy.jar"  dest="bintools" overwrite="true"/>
		<unjar src="lib/beangenlibs/jaxws-libs.jar"  dest="bintools" overwrite="true"/>
		<unjar src="lib/beangenlibs/jdom.jar"  dest="bintools" overwrite="true"/>
		
		
		
		<unjar src="lib/jaxws/jaxws-tools.jar"  dest="bintools" overwrite="true"/>
				
		<unjar src="lib/jaxws/FastInfoset.jar" dest="bintools" overwrite="true"/>
		<unjar src="lib/jaxws/http.jar" dest="bintools" overwrite="true"/>
		<unjar src="lib/jaxws/jaxb-api.jar" dest="bintools" overwrite="true"/>
		<unjar src="lib/jaxws/jaxb-impl.jar" dest="bintools" overwrite="true"/>
		<unjar src="lib/jaxws/jaxb-xjc.jar" dest="bintools" overwrite="true"/>
		<unjar src="lib/jaxws/jaxws-api.jar" dest="bintools" overwrite="true"/>
		<unjar src="lib/jaxws/jaxws-rt.jar" dest="bintools" overwrite="true"/>				
		<unjar src="lib/jaxws/jsr173_api.jar" dest="bintools" overwrite="true"/>
		<unjar src="lib/jaxws/jsr181-api.jar" dest="bintools" overwrite="true"/>
		<unjar src="lib/jaxws/jsr250-api.jar" dest="bintools" overwrite="true"/>
		<unjar src="lib/jaxws/saaj-api.jar" dest="bintools" overwrite="true"/>
		<unjar src="lib/jaxws/saaj-impl.jar" dest="bintools" overwrite="true"/>
		<unjar src="lib/jaxws/sjsxp.jar" dest="bintools" overwrite="true"/>
		

		<copy file="biocep-core-tomcat.jar" todir="bintools"/>
		
			<manifest file="MANIFEST.MF">
				<attribute name="Built-By" value="Karim Chine"/>
				<attribute name="Main-Class" value="ToolsMain"/>
			</manifest>		
						
			<jar destfile="biocep-tools.jar" manifest="MANIFEST.MF">
					<fileset dir="bintools"/>
					<fileset dir="binsrv"/>
			</jar>
			
		
		-->
		<!-- tools end -->
		
		
		<!-- biocep starts -->
		
			<unjar src="lib/desktop/OpenXLS.jar"  dest="binsrv" overwrite="true"/>
			<unjar src="lib/desktop/pf-joi-full.jar"  dest="binsrv" overwrite="true"/>
			<unjar src="lib/desktop/idw-gpl.jar"  dest="binsrv" overwrite="true"/>
			<unjar src="lib/desktop/PDFRenderer.jar"  dest="binsrv" overwrite="true"/>
			<unjar src="lib/desktop/swing-layout-1.0.3.jar"  dest="binsrv" overwrite="true"/>
			<unjar src="lib/desktop/freemindbrowser.jar"  dest="binsrv" overwrite="true"/>
			<unjar src="lib/svg/batik-anim.jar"  dest="binsrv" overwrite="true"/>
			<unjar src="lib/svg/batik-bridge.jar"  dest="binsrv" overwrite="true"/>
			<unjar src="lib/svg/batik-css.jar"  dest="binsrv" overwrite="true"/>
			<unjar src="lib/svg/batik-ext.jar"  dest="binsrv" overwrite="true"/>
			<unjar src="lib/svg/batik-extension.jar"  dest="binsrv" overwrite="true"/>
			<unjar src="lib/svg/batik-gui-util.jar"  dest="binsrv" overwrite="true"/>
			<unjar src="lib/svg/batik-gvt.jar"  dest="binsrv" overwrite="true"/>
			<unjar src="lib/svg/batik-parser.jar"  dest="binsrv" overwrite="true"/>
			<unjar src="lib/svg/batik-script.jar"  dest="binsrv" overwrite="true"/>
			<unjar src="lib/svg/batik-svg-dom.jar"  dest="binsrv" overwrite="true"/>
			<unjar src="lib/svg/batik-swing.jar"  dest="binsrv" overwrite="true"/>
			<unjar src="lib/svg/batik-xml.jar"  dest="binsrv" overwrite="true"/>
			<unjar src="lib/svg/js.jar"  dest="binsrv" overwrite="true"/>
			<unjar src="lib/svg/xml-apis.jar"  dest="binsrv" overwrite="true"/>
			<unjar src="lib/svg/xml-apis-ext.jar"  dest="binsrv" overwrite="true"/>				
			<unjar src="${GROOVY_JAR}"  dest="binsrv" overwrite="true"/>
		
			<property 	name="src_client_target" value="src_client:src_patch_joi:src_patch_freemind"/>		
			<javac srcdir="${src_client_target}"
				destdir="binsrv" debug="true" source="1.5" target="1.5">
				<classpath>
					<pathelement location="binsrv"/>				
				</classpath>
			</javac>
		
			<for list="${src_client_target}" param="source" delimiter=":">
					  <sequential>
						<copy todir="binsrv">				
							<fileset dir="@{source}">
								<include name="**/*.xml"/>
								<include name="**/*.props"/>
								<include name="**/*.properties"/>
								<include name="**/*.R"/>
								<include name="**/*.r"/>
								<include name="**/*.png"/>
								<include name="**/*.gif"/>
								<include name="**/*.html"/>
								<include name="**/*.exe"/>
								<include name="**/*.jar"/>
							</fileset>				
						</copy>
					  </sequential>
			</for>
		
			<manifest file="MANIFEST.MF">
				<attribute name="Built-By" value="Karim Chine"/>
				<attribute name="Main-Class" value="org.kchine.r.workbench.WorkbenchLauncher"/>
			</manifest>		
			
			<jar basedir="binsrv" destfile="biocepunsigned.jar" manifest="MANIFEST.MF" />
			<signjar jar="biocepunsigned.jar" signedjar="biocep.jar" alias="appletsigningkey" keystore="keys/appletKeyStore.ks"  storepass="cloudera" />		
					
			<antcall target="sign.extra"/>
		
			
			<!-- biocep ends -->		
	</target>
	
	
	<target name="basiceditor" depends="compile">
		
			<delete dir="binjedit" failonerror="true"/>
			<mkdir dir="binjedit"/>

			<unjar src="lib/desktop/jedit.jar"  dest="binjedit" overwrite="true"/>
					
			<javac srcdir="src_patch_jedit" destdir="binjedit" debug="true" source="1.5" target="1.5">
				<classpath>
					<pathelement path="${CORE_JAR}"/>
					<pathelement path="lib/desktop/idw-gpl.jar"/>
					<pathelement path="lib/desktop/jedit.jar"/>
				</classpath>
			</javac>
			
			<copy todir="binjedit">				
				<fileset dir="src_patch_jeditmodes">
				<include name="**/*"/>											
				</fileset>				
			</copy>

			<copy todir="binjedit">				
				<fileset dir="src_patch_jedit">
					<include name="**/*" />
					<exclude name="**/*.java" />
				</fileset>				
			</copy>
		
			<jar basedir="binjedit" destfile="basiceditorunsigned.jar" />
			<signjar jar="basiceditorunsigned.jar" signedjar="src_client/org/kchine/r/workbench/plugins/embedded/basiceditor.jar" alias="appletsigningkey" keystore="keys/appletKeyStore.ks"  storepass="cloudera" />
	
	</target>
	
	
	
	<target name="sign.extra"  depends="initializeProperties" >
			
		<copy todir=".">
			<fileset dir="lib/desktop" includes="biocep-doc.jar"/>			
		</copy>
		<signjar jar="biocep-doc.jar" signedjar="biocep-doc.jar" alias="appletsigningkey" keystore="keys/appletKeyStore.ks"  storepass="cloudera" />

		<copy todir=".">
			<fileset dir="lib/desktop" includes="derby.jar"/>			
		</copy>
		<signjar jar="derby.jar" signedjar="derby.jar" alias="appletsigningkey" keystore="keys/appletKeyStore.ks"  storepass="cloudera" />

		<copy todir=".">
			<fileset dir="lib/desktop" includes="derbynet.jar"/>			
		</copy>
		<signjar jar="derbynet.jar" signedjar="derbynet.jar" alias="appletsigningkey" keystore="keys/appletKeyStore.ks"  storepass="cloudera" />
					
	</target>
	
	<target name="pdfviewer"  depends="initializeProperties" >

		<javac
			srcdir="src_pdfviewer" destdir="binpdfviewer" debug="true" source="1.5" target="1.5">
			<classpath>
				<pathelement path="${CORE_JAR}"/>
				<fileset dir="lib">
					<include name="**/*.jar"/>
				</fileset>
			</classpath>
		</javac>
		
		<copy todir="binpdfviewer">				
			<fileset dir="src_pdfviewer">
				<include name="**/*.pdf"/>
			</fileset>				
		</copy>
		
		<jar destfile="pdfviewer.jar">
			<fileset dir="binpdfviewer"/>
		</jar>

	</target>
	
	
	
	
	<target name="compile" depends="initializeProperties">
		
		<echo message="${basedir}"/>
		<property name="src_compile_target" value="src_rpf_common:src_rpf:src_server_common:src_server:src_tools:src_client:src_masq:src_patch_rJava:src_patch_JavaGD:src_patch_iplots:src_patch_joi:src_patch_freemind:src_scilab:src_openoffice"/>
		
		<javac
			srcdir="${src_compile_target}"
			destdir="bin" debug="true" source="1.5" target="1.5">
			<classpath>
				<fileset dir="lib">
					<include name="**/*.jar"/>
				</fileset>
			</classpath>
		</javac>
		
		<rmic classpath="bin" base="bin" classname="org.kchine.r.server.impl.RServantImpl"/>
		<rmic classpath="bin" base="bin" classname="org.kchine.r.server.impl.AssignInterfaceImpl"/>
		<rmic classpath="bin" base="bin" classname="org.kchine.r.server.impl.RNIImpl"/>
		<rmic classpath="bin" base="bin" classname="org.kchine.r.server.impl.GraphicNotifierImpl"/>
		<rmic classpath="bin" base="bin" classname="org.kchine.r.server.impl.GDDeviceImpl"/>
		
		<rmic classpath="bin" base="bin" classname="org.kchine.r.server.spreadsheet.TableModelRemoteImpl"/>
		<rmic classpath="bin" base="bin" classname="org.kchine.r.server.spreadsheet.TableModelListenerRemoteImpl"/>
		<rmic classpath="bin" base="bin" classname="org.kchine.r.server.spreadsheet.SpreadsheetModelRemoteImpl"/>
		<rmic classpath="bin" base="bin" classname="org.kchine.r.server.spreadsheet.SpreadsheetListenerRemoteImpl"/>
		<rmic classpath="bin" base="bin" classname="org.kchine.r.server.spreadsheet.SpreadsheetModelDeviceImpl"/>
				
		<rmic classpath="bin" base="bin" classname="org.rosuda.ibase.SVarSetInterfaceRemoteImpl"/>
		<rmic classpath="bin" base="bin" classname="org.rosuda.ibase.SVarInterfaceRemoteImpl"/>
		<rmic classpath="bin" base="bin" classname="org.rosuda.ibase.SMarkerInterfaceRemoteImpl"/>
		<rmic classpath="bin" base="bin" classname="org.rosuda.ibase.DependentRemoteImpl"/>

		
		<rmic classpath="bin" base="bin" classname="org.kchine.rpf.db.NodeManagerImpl"/>
		
		<for list="${src_compile_target}" param="source" delimiter=":">
		  <sequential>
			<copy todir="bin">				
				<fileset dir="@{source}">
					<include name="**/*.xml"/>
					<include name="**/*.props"/>
					<include name="**/*.properties"/>
					<include name="**/*.R"/>
					<include name="**/*.r"/>
					<include name="**/*.png"/>
					<include name="**/*.gif"/>
					<include name="**/*.html"/>
					<include name="**/*.sql"/>
					<include name="**/*.exe"/>
					<include name="**/*.jar"/>
					
				</fileset>				
			</copy>
		  </sequential>
		</for>
				
		
			

		<jar destfile="${CORE_JAR}">
			<fileset dir="bin"/>
		</jar>
		
	</target>

	
	<target name="compile.rpf" depends="initializeProperties">
		
		<javac srcdir="src_rpf_common:src_rpf" destdir="binrpf" debug="true" source="1.5"
			target="1.5">
			<classpath>
				<pathelement path="${JRI_JAR}"/>
				<fileset dir="lib">
					<include name="**/*.jar"/>
				</fileset>
				
			</classpath>
		</javac>
		
		<copy todir="binrpf">
			<fileset dir="src_rpf_common">
				<include name="**/*"/>
			</fileset>
		</copy>
		<copy todir="binrpf">
			<fileset dir="src_rpf">
				<include name="**/*"/>
			</fileset>
		</copy>
		
		<jar destfile="${RPF_JAR}">
			<fileset dir="binrpf"/>
		</jar>
	</target>
	
	<target name="jaxwspack"  depends="initializeProperties">		
		<jar basedir="jaxws" destfile="jaxws-libs.jar" manifest="MANIFEST.MF" />		
	</target>
	
</project>